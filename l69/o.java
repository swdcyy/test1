package l69.o;
import h69.f;
import com.yxcorp.gifshow.aicutv2.VideoTemplateProject;
import java.lang.String;
import com.kuaishou.edit.draft.Workspace$Type;
import com.kuaishou.edit.draft.Workspace$Source;
import com.kuaishou.edit.draft.Workspace$From;
import com.kuaishou.client.log.content.packages.nano.ClientContent$LocalIntelligentAlbumPackage;
import java.lang.Object;
import kotlin.jvm.internal.a;
import h69.g;
import q87.c;
import l69.n;
import o69.c;
import com.kwai.kve.AlbumType;
import java.lang.Class;
import com.kwai.robust.PatchProxy;
import com.kwai.robust.PatchProxyResult;
import java.lang.Boolean;
import h69.j;
import n69.c;
import i69.f;
import l69.o$a;
import k69.e;
import nsd.u;
import s69.i;
import com.yxcorp.gifshow.edit.draft.model.workspace.c;
import l69.p;
import java.lang.Enum;
import com.yxcorp.gifshow.upload.AuditFrameSwitch;
import java.lang.StringBuilder;
import com.kwai.video.minecraft.model.EditorSdk2V2$VideoEditorProject;
import l69.t;
import com.yxcorp.gifshow.edit.draft.DraftUtils;
import fba.a;
import lba.a;
import java.util.Objects;
import java.lang.Number;
import com.google.protobuf.GeneratedMessageLite;
import com.yxcorp.gifshow.edit.draft.model.c;
import com.kuaishou.edit.draft.OriginalVoice;
import yaa.c;
import com.kuaishou.edit.draft.Music;
import lnc.w6;
import lnc.g7;
import com.yxcorp.gifshow.aicut.KwaiAICutStyle;
import com.kuaishou.edit.draft.FeatureId;
import java.lang.Double;
import java.lang.CharSequence;
import com.yxcorp.utility.TextUtils;
import java.util.Map;
import o69.o2;
import com.yxcorp.gifshow.aicut.api.AICutMusicInfo;
import i69.d;
import j69.a;
import j69.c;
import com.kuaishou.edit.draft.AICutTheme;
import brd.t;
import java.lang.Long;
import pb9.p;
import org.json.JSONObject;
import jn4.a;
import jn4.e;
import com.kwai.feature.post.api.feature.recommend.PostRecommendDataManager;
import cjd.e;
import erd.o;
import n69.b;
import l69.o$b;
import l69.o$c;
import l69.o$d;
import erd.a;
import kotlin.Pair;
import java.util.List;
import qrd.r0;
import java.util.Iterator;
import java.lang.Iterable;
import com.yxcorp.gifshow.models.QMedia;
import android.graphics.Bitmap;
import com.kwai.gifshow.post.api.core.camerasdk.model.VideoContext;
import qr4.i;
import qr4.e$h;
import qr4.e$v;
import qr4.m$k0;
import com.yxcorp.gifshow.aicut.VideoTemplate;
import com.kwai.video.minecraft.model.EditorSdk2UtilsV2;
import java.lang.Integer;
import com.yxcorp.utility.Log;
import qr4.m$a;
import java.util.ArrayList;
import trd.u;
import java.util.Collection;
import qr4.m$l0;
import qrd.l1;
import wba.u;
import com.google.protobuf.GeneratedMessageLite$Builder;
import com.kuaishou.edit.draft.Workspace$b;
import java.lang.System;
import maa.a;
import haa.a;
import wba.n0;
import wba.c;
import com.kwai.gifshow.post.api.core.camerasdk.model.Size;
import com.kwai.sdk.switchconfig.a;
import wba.e0;
import wba.d;
import com.kuaishou.edit.draft.Asset;
import com.yxcorp.gifshow.edit.draft.model.DraftFileManager;
import java.io.File;
import qkd.b;
import com.kuaishou.edit.draft.Asset$b;
import u80.d;
import java.lang.IllegalArgumentException;
import java.lang.Throwable;
import com.yxcorp.gifshow.util.PostUtils;
import kotlin.collections.CollectionsKt__CollectionsKt;
import com.yxcorp.gifshow.aicut.kwai.memory.AICutAnnualMemoryProject;
import i79.b;
import com.yxcorp.gifshow.album.model.KSMemoryClipType;
import com.kuaishou.edit.draft.Asset$PositionType;
import com.kuaishou.edit.draft.TimeRange$b;
import com.kuaishou.edit.draft.TimeRange;
import i79.a;
import com.kuaishou.edit.draft.AEEffect$b;
import com.kuaishou.edit.draft.AEEffect;
import w46.b;
import qaa.a;
import wba.m;
import haa.f;
import wba.l;
import laa.f;
import java.util.HashMap;
import com.yxcorp.gifshow.aicut.kwai.memory.AICutAnnualMemoryProject$a;
import i79.c;
import com.kuaishou.edit.draft.Cover$b;
import com.kuaishou.edit.draft.ImportCoverParamV2$b;
import com.kuaishou.edit.draft.ImportCoverParamV2;
import com.kuaishou.android.model.music.Music;
import java.lang.Float;
import com.yxcorp.gifshow.music.utils.o;
import com.kuaishou.edit.draft.Music$b;
import com.kuaishou.edit.draft.Music$Source;
import com.kuaishou.edit.draft.Music$Type;
import com.kwai.video.minecraft.model.EditorSdk2V2$AudioAsset;
import com.kwai.gifshow.post.api.feature.music.model.MusicClipInfo;
import tkd.b;
import tkd.d;
import kob.i;
import com.yxcorp.gifshow.aicut.api.AICutStyle;
import gq.a;
import wba.o0;
import com.kuaishou.edit.draft.OriginalVoice$b;
import com.yxcorp.gifshow.util.PostExperimentUtils;
import lnc.p3;
import com.kwai.kve.ProjectItem;
import com.yxcorp.gifshow.localwork.model.LongVideoLocalProject;
import com.kwai.kve.SmartEditTask;
import u80.h;
import com.kuaishou.gifshow.kuaishan.KSSource;
import com.yxcorp.gifshow.aicut.VideoTemplateResponse;
import com.yxcorp.gifshow.aicut.VideoTemplateGroupInfo;
import com.kwai.feature.post.api.music.data.MusicSource;
import qr4.e$t;
import java.lang.RuntimeException;
import com.kuaishou.edit.draft.CropOptions;
import kotlin.collections.CollectionsKt___CollectionsKt;
import java.util.Collections;
import nsd.s0;

public final class o implements f	// class@002ca6
{
    public boolean a;
    public c b;
    public c c;
    public EditorSdk2V2$VideoEditorProject d;
    public final h e;
    public Bitmap f;
    public final VideoTemplateProject g;
    public final String h;
    public Workspace$Type i;
    public Workspace$Source j;
    public Workspace$From k;
    public ClientContent$LocalIntelligentAlbumPackage l;
    public boolean m;

    public void o(VideoTemplateProject p0,String p1,Workspace$Type p2,Workspace$Source p3,Workspace$From p4,ClientContent$LocalIntelligentAlbumPackage p5,boolean p6){
       a.p(p0, "mAICutProject");
       a.p(p1, "mTaskId");
       a.p(p2, "mOriginType");
       a.p(p3, "mSource");
       a.p(p4, "mPageFrom");
       super();
       this.g = p0;
       this.h = p1;
       this.i = p2;
       this.j = p3;
       this.k = p4;
       this.l = p5;
       this.m = p6;
       int i = 0;
       Object[] objArray = new Object[i];
       g.D().w("KwaiAICutProject", "init called", objArray);
       n.f.f();
       if (this.j == Workspace$Source.ANNUAL_ALBUM_2022) {
          i = true;
       }
       p0.O = i;
       AlbumType mEMORY = (this.i == Workspace$Type.ALBUM_MOVIE)? AlbumType.MEMORY: AlbumType.AICUT;
       p0.n0(mEMORY);
       p0.o = this.l;
       mEMORY = PatchProxy.apply(null, this, o.class, "38");
       boolean b = (mEMORY != PatchProxyResult.class)? mEMORY.booleanValue(): j.h(this.j) ^ 1;
       if (b) {
          this.c = new c(p0, p1, this.i, this.j);
       }
       this.g();
       o$a uoa = new o$a(this);
       this.e = uoa;
       p0.d(uoa);
       return;
    }
    public void o(VideoTemplateProject p0,String p1,Workspace$Type p2,Workspace$Source p3,Workspace$From p4,ClientContent$LocalIntelligentAlbumPackage p5,boolean p6,int p7,u p8){
       String str = (p7 & 0x02)? i.a.b(): p1;
       Workspace$Source source = null;
       Workspace$Type aI_CUT = (p7 & 0x04)? Workspace$Type.AI_CUT: source;
       if (p7 & 0x08) {
          source = Workspace$Source.IMPORT;
       }
       Workspace$From fROM_UNKNOW = (p7 & 0x10)? Workspace$From.FROM_UNKNOW: p4;
       int i = (p7 & 0x40)? 0: p6;
       super(p0, str, aI_CUT, source, fROM_UNKNOW, 0, i);
       return;
    }
    public final c a(){
       return this.b;
    }
    public final VideoTemplateProject b(){
       return this.g;
    }
    public final boolean c(){
       return this.m;
    }
    public final Workspace$Type d(){
       return this.i;
    }
    public final Workspace$Source e(){
       return this.j;
    }
    public final String f(){
       return this.h;
    }
    public final void g(){
       AuditFrameSwitch mAiCutEnable;
       if (PatchProxy.applyVoid(null, this, o.class, "2")) {
          return;
       }
       o tg = this.g;
       int i = p.a[this.i.ordinal()];
       int i1 = 1;
       if (i != i1) {
          mAiCutEnable = (i != 2)? AuditFrameSwitch.getSwitch().mAiCutEnabled: AuditFrameSwitch.getSwitch().mAlbumMovieEnabled;
       }else {
          mAiCutEnable = AuditFrameSwitch.getSwitch().mPhotoMovieEnabled;
       }
       tg.W = mAiCutEnable;
       if (j.h(this.j)) {
          this.g.X = i1;
       }
       Object[] objArray = new Object[0];
       g.D().w("KwaiAICutProject", "initAuditFrameEnabled: "+this.g.F0(), objArray);
       return;
    }
    public final void h(EditorSdk2V2$VideoEditorProject p0,c p1){
       o g;
       t a;
       Object[] obj2;
       StringBuilder obj3;
       double d3;
       String external;
       String str1;
       AICutMusicInfo uAICutMusicI;
       AICutMusicInfo uAICutMusicI2;
       Workspace$Type type = this;
       a obj = p0;
       Object obj1 = p1;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       t ot = t.class;
       if (PatchProxy.applyVoidTwoRefs(obj, obj1, type, o.class, "35")) {
          return;
       }
       a.p(obj, "videoProject");
       a.p(obj1, "draft");
       Object[] objArray = new Object[0];
       g.D().w("KwaiAICutProject", "initIfNeed: ", objArray);
       double d = type.g.O();
       double d1 = type.g.N();
       String str = "2";
       if (type.b == null) {
          Workspace$Type type1 = p1.a1();
          a.o(type1, "draft.type");
          type.i = type1;
          Workspace$Source source = p1.T0();
          a.o(source, "draft.source");
          type.j = source;
          type.b = obj1;
          g = type.g;
          Workspace$Type aLBUM_MOVIE = Workspace$Type.ALBUM_MOVIE;
          AlbumType mEMORY = (p1.b1() == aLBUM_MOVIE || p1.a1() == aLBUM_MOVIE)? AlbumType.MEMORY: AlbumType.AICUT;
          g.n0(mEMORY);
          if (!this.i() && (p1.a1() != Workspace$Type.KUAISHAN && (!DraftUtils.K(p1) || DraftUtils.E(p1.n0())))) {
             a = t.a;
             a uoa = p1.g1();
             Objects.requireNonNull(a);
             obj2 = PatchProxy.applyOneRefs(uoa, a, ot, str);
             if (obj2 != patchProxyRe) {
                d = obj2.doubleValue();
             }else if(uoa != null){
                OriginalVoice originalVoic = uoa.v();
                if (originalVoic != null) {
                   a.o(originalVoic, "voice");
                   d = (double)originalVoic.getVolume();
                }
             }
             a = 0xbff0000000000000;
          }
          double d2 = d;
          a = t.a;
          c uoc = p1.J0();
          Objects.requireNonNull(a);
          obj3 = PatchProxy.applyOneRefs(uoc, a, ot, "1");
          if (obj3 != patchProxyRe) {
             d3 = obj3.doubleValue();
          }else if(uoc != null){
             Music music1 = w6.c(uoc);
             if (music1 != null) {
                d3 = (double)music1.getVolume();
             }
          }
          d3 = 0x3fe0000000000000;
          double d4 = d3;
          this.q();
          if (g7.a(p1) && g7.a.o(obj1)) {
             j.r(p1, KwaiAICutStyle.newEmptyStyle(), 0, false, true);
          }
          this.g();
          d = d2;
          d1 = d4;
       }
       type.g.w0(obj);
       obj3 = j.d(obj1, true);
       c uoc1 = p1.J0();
       if (uoc1 != null) {
          Music music = uoc1.v();
          if (music != null) {
             FeatureId featureId = music.getFeatureId();
             if (featureId != null) {
                external = featureId.getExternal();
             label_012d :
                type.g.j(DraftUtils.S(p1));
                o g1 = type.g;
                Objects.requireNonNull(g1);
                VideoTemplateProject videoTemplat = VideoTemplateProject.class;
                int i = 5;
                if (PatchProxy.isSupport(videoTemplat)) {
                   Object[] objArray1 = new Object[i];
                   objArray1[0] = obj;
                   objArray1[1] = Double.valueOf(d);
                   objArray1[2] = Double.valueOf(d1);
                   objArray1[3] = obj3;
                   objArray1[4] = external;
                   if (PatchProxy.applyVoid(objArray1, g1, videoTemplat, str)) {
                      obj2 = 0;
                   }else {
                   label_0169 :
                      a.p(obj, "videoProject");
                      c uoc2 = c.class;
                      if (PatchProxy.isSupport(uoc2)) {
                         Object[] objArray2 = new Object[i];
                         objArray2[0] = obj;
                         objArray2[1] = Double.valueOf(d);
                         objArray2[2] = Double.valueOf(d1);
                         objArray2[3] = obj3;
                         objArray2[4] = external;
                         if (PatchProxy.applyVoid(objArray2, g1, uoc2, "49")) {
                            obj2 = 0;
                         label_0262 :
                            if (g1.V != null) {
                               g1.o0(d.d.a().c().F2());
                            }
                         }
                      }
                      a.p(obj, "videoProject");
                      g1.x = d;
                      g1.y = d1;
                      g1.m = obj;
                      obj2 = new Object[0];
                      g.D().w("AICutProject", "initIfNeed: style="+obj3+", music id="+external, obj2);
                      if (TextUtils.x(obj3)) {
                         objArray1 = new Object[0];
                         g.D().w("AICutProject", "init styleId is empty --> Ô­Æ¬", objArray1);
                         str1 = "-2";
                      }else {
                         str1 = String.valueOf(obj3);
                      }
                      o2 oo2 = g1.A.get(str1);
                      if (oo2 == null) {
                         uAICutMusicI = null;
                         oo2 = new o2(uAICutMusicI, 1, uAICutMusicI);
                         g1.A.put(str1, oo2);
                      }else {
                         uAICutMusicI = 0;
                      }
                      if (external != null) {
                         c w = g1.w;
                         obj3 = (w != null)? w.getMId(): uAICutMusicI;
                         if ((a.g(obj3, external) ^ 1) && oo2.b() == null) {
                            Object[] objArray3 = new Object[0];
                            g.D().w("AICutProject", "initIfNeed: init current music from draft", objArray3);
                            oo2.e(d.d.a().c().F2());
                         }
                      }
                   label_0227 :
                      g1.v0(str1);
                      g og = g.D();
                      obj3 = "initIfNeed: styleId="+g1.q+",statusMusicId=";
                      AICutMusicInfo uAICutMusicI1 = oo2.b();
                      String mId = (uAICutMusicI1 != null)? uAICutMusicI1.getMId(): uAICutMusicI;
                      Object[] objArray4 = new Object[0];
                      og.w("AICutProject", obj3+mId+"  musicId="+external, objArray4);
                      goto label_0262 ;
                   }
                }else {
                   goto label_0169 ;
                }
                obj = p1.n0();
                if (obj != null) {
                   AICutTheme uAICutTheme = obj.v();
                   if (uAICutTheme != null) {
                      o g2 = type.g;
                      a.o(uAICutTheme, "aiCutTheme");
                      String visionEngine = (uAICutTheme.getVisionEngineResultCount() > 0)? uAICutTheme.getVisionEngineResult(0): obj2;
                      g2.T = visionEngine;
                   }
                }
                return;
             }
          }
       }
       external = null;
       goto label_012d ;
    }
    public final boolean i(){
       Object[] objArray = null;
       o obj = PatchProxy.apply(objArray, this, o.class, "36");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       obj = this.b;
       Workspace$Type type = (obj != null)? obj.a1(): objArray;
       o tb = this.b;
       if (tb != null) {
          objArray = tb.T0();
       }
       return j.n(type, objArray);
    }
    public final t j(long p0,String p1){
       Object[] obj;
       t ot;
       t ot1;
       c a;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       o oo = o.class;
       if (PatchProxy.isSupport(oo)) {
          obj = PatchProxy.applyTwoRefs(Long.valueOf(p0), p1, this, oo, "5");
          if (obj != patchProxyRe) {
             return obj;
          }
       }
       oo = this.c;
       int i = 0;
       if (oo == null) {
          Object[] objArray = new Object[i];
          g.D().w("KwaiAICutProject", "loadRecoMusicList mMusicRecoManager is null,do nothing", objArray);
          ot = t.just(Boolean.TRUE);
          a.o(ot, "Observable.just\(true\)");
          return ot;
       }else {
          a.m(oo);
          Objects.requireNonNull(oo);
          c uoc = c.class;
          if (PatchProxy.isSupport(uoc)) {
             ot1 = PatchProxy.applyTwoRefs(Long.valueOf(p0), p1, oo, uoc, "3");
             if (ot1 != patchProxyRe) {
             label_00e2 :
                ot = ot1.map(new o$b(this)).onErrorReturn(o$c.b).doFinally(new o$d(this));
                a.o(ot, "mMusicRecoManager!!.load\x20\x02ager?.destroy\(\)\n        }\x00");
                return ot;
             }
          }
          if (p1 == null) {
             a = oo.a;
             a = (a != null)? a.c(oo.c): null;
          }
       label_0057 :
          String str = p1;
          JSONObject jSONObject = new JSONObject();
          jSONObject.put("photoType", oo.d.getNumber());
          jSONObject.put("photoSource", oo.e.getNumber());
          jSONObject.put("enable_aicut_music_recommend", 1);
          String str1 = jSONObject.toString();
          a.o(str1, "JSONObject\(\).let {\n     ¡­      it.toString\(\)\n    }");
          obj = new Object[i];
          g.D().w("AICutMusicRecoManager", "loadRecommendMusic: duration="+p0+" ,sessionId="+str, obj);
          PostRecommendDataManager postRecommen = PostRecommendDataManager.b();
          a.o(postRecommen, "PostRecommendDataManager.getInstance\(\)");
          ot1 = e.a().a(postRecommen.c(), str, "", p0, str1, 1, -1).map(new e()).map(b.b);
          a.o(ot1, "EditMusicApiServiceManag\x20\x02 ?: ArrayList\(\)\n        }\x00");
          goto label_00e2 ;
       }
    }
    public final Pair k(boolean p0){
       List obj;
       Iterator iterator1;
       Object obj1;
       o oo = o.class;
       if (PatchProxy.isSupport(oo)) {
          obj = PatchProxy.applyOneRefs(Boolean.valueOf(p0), this, oo, "42");
          if (obj != PatchProxyResult.class) {
             return obj;
          }
       }
       oo = this.b;
       if (oo != null) {
          obj = j.f(oo);
          if (this.g.M().size() != obj.size()) {
             return r0.a(Boolean.TRUE, obj);
          }else {
             Iterator iterator = this.g.M().iterator();
             while (iterator.hasNext()) {
                QMedia qMedia = iterator.next();
                if (p0) {
                   iterator1 = obj.iterator();
                   while (true) {
                      if (iterator1.hasNext()) {
                         obj1 = iterator1.next();
                         Object obj2 = obj1;
                         obj2 = (a.g(obj2.path, qMedia.path) && !obj2.mClipStart - qMedia.mClipStart)? 1: null;
                         if (!obj2) {
                            continue ;
                         }
                      }else {
                         obj1 = null;
                      }
                      if (obj1 != null) {
                      }else {
                         return r0.a(Boolean.TRUE, obj);
                      }
                   }
                }else {
                   iterator1 = obj.iterator();
                   while (true) {
                      if (iterator1.hasNext()) {
                         obj1 = iterator1.next();
                         if (!a.g(obj1.path, qMedia.path)) {
                            continue ;
                         }
                      }else {
                         obj1 = null;
                      }
                      if (obj1 != null) {
                         continue ;
                      }else {
                         return r0.a(Boolean.TRUE, obj);
                      }
                   }
                }
             }
          }
       }
       return r0.a(Boolean.FALSE, null);
    }
    public final void l(){
       if (PatchProxy.applyVoid(null, this, o.class, "9")) {
          return;
       }
       o tf = this.f;
       if (tf != null && !tf.isRecycled()) {
          tf.recycle();
       }
       this.f = null;
       return;
    }
    public final void m(VideoContext p0,boolean p1){
       String mId;
       i d;
       String name;
       Object obj = this;
       e$h obj1 = p0;
       VideoContext videoContext = VideoContext.class;
       o oo = o.class;
       if (PatchProxy.isSupport(oo) && PatchProxy.applyVoidTwoRefs(obj1, Boolean.valueOf(p1), obj, oo, "29")) {
          return;
       }
       AICutMusicInfo uAICutMusicI = obj.g.K();
       String str = "";
       if (uAICutMusicI != null) {
          mId = uAICutMusicI.getMId();
          if (mId != null) {
          label_002d :
             if (obj.i == Workspace$Type.ALBUM_MOVIE) {
                str = obj.g.X();
                Objects.requireNonNull(p0);
                if (!PatchProxy.applyVoidTwoRefs(str, mId, obj1, videoContext, "186")) {
                   VideoContext.b();
                   d = obj1.a.d;
                   if (d.K == null) {
                      d.K = new e$v();
                      obj1 = obj1.a.d.K;
                      obj1.a = str;
                      obj1.b = mId;
                   }
                }
                return;
             }else if(p0.G().b.T != null){
                return;
             }else {
                o g = obj.g;
                VideoTemplate videoTemplat = g.L0(g.X());
                if (videoTemplat != null) {
                   name = videoTemplat.getName();
                   if (name != null) {
                   label_0082 :
                      long l = (long)(EditorSdk2UtilsV2.getDisplayDuration(obj.g.a0()) * (double)1000.00f);
                      AICutMusicInfo uAICutMusicI1 = obj.g.K();
                      c uoc = null;
                      String mName = (uAICutMusicI1 != null)? uAICutMusicI1.getMName(): uoc;
                      if (!TextUtils.x(mName)) {
                         AICutMusicInfo uAICutMusicI2 = obj.g.K();
                         if (uAICutMusicI2 != null) {
                            uoc = uAICutMusicI2.getMName();
                         }
                         str = String.valueOf(uoc);
                      }
                      o g1 = obj.g;
                      uoc = g1.l;
                      mName = g1.X();
                      int i = obj.g.M().size();
                      String str1 = str;
                      String str2 = name;
                      int i1 = (obj.g.O() - (double)0 >= 0)? (int)(obj.g.O() * (double)100): 0;
                      if (PatchProxy.isSupport(videoContext)) {
                         Object[] objArray = new Object[]{Long.valueOf(uoc),Long.valueOf(l),mId,str1,mName,str2,Integer.valueOf(i),Integer.valueOf(i1)};
                         if (PatchProxy.applyVoid(objArray, obj1, videoContext, "184")) {
                         label_019b :
                            if (!TextUtils.x(obj.g.V())) {
                               obj1.z1(obj.g.V(), obj.g.E);
                            }
                            if (!TextUtils.x(obj.g.W())) {
                               obj1.S1(obj.g.W());
                            }
                            List list = obj.g.M();
                            ArrayList uArrayList = new ArrayList(u.Y(list, 10));
                            Iterator iterator = list.iterator();
                            while (iterator.hasNext()) {
                               uArrayList.add(iterator.next().path);
                            }
                            String[] stringArray = new String[0];
                            Object[] objArray1 = uArrayList.toArray(stringArray);
                            Objects.requireNonNull(objArray1, "null cannot be cast to non-null type kotlin.Array<T>");
                            obj1.c1(objArray1);
                            p0.G().b.T.q = p1;
                            return;
                         }
                      }
                      VideoContext.b();
                      name = str1;
                      String str3 = str2;
                      Log.b("VideoContext", "saveOriginalAiCutInfo\(\) called with: duration = ["+uoc+"], durationAlg = ["+l+"], musicId = ["+mId+"], musicName = ["+name+"], styleId = ["+mName+"], styleName = ["+str3+"], materialCount = ["+i+"]voiceVolume="+i1);
                      d = obj1.a.b;
                      if (d.T == null) {
                         d.T = new m$a();
                      }
                      m$k0 t = obj1.a.b.T;
                      t.e = uoc;
                      t.f = l;
                      t.a = i;
                      t.j = mId;
                      t.k = name;
                      t.h = mName;
                      t.i = str3;
                      t.p = i1;
                      goto label_019b ;
                   }
                }
                name = str;
                goto label_0082 ;
             }
          }
       }
       mId = str;
       goto label_002d ;
    }
    public final void n(VideoContext p0){
       if (PatchProxy.applyVoidOneRefs(p0, this, o.class, "32")) {
          return;
       }
       String str = this.g.X();
       VideoTemplate videoTemplat = this.g.L0(str);
       int type = (videoTemplat != null)? videoTemplat.getType(): 0;
       m$l0 ol0 = new m$l0();
       ol0.a = str;
       ol0.b = type;
       p0.S0 = ol0;
       return;
    }
    public final void o(c p0,VideoTemplate p1,boolean p2,boolean p3){
       String this;
       String str4;
       Size size;
       o g;
       o oo2;
       u ou1;
       String str8;
       String str9;
       String str10;
       String str11;
       String str12;
       String str13;
       int i1;
       int this1;
       Object[] objArray1;
       String str14;
       PatchProxyResult patchProxyRe1;
       int i2;
       Object[] this1;
       String id;
       object oobject;
       u this11;
       u a;
       double d;
       Object[] objArray2;
       Object[] objArray3;
       KwaiAICutStyle aiCutStyle;
       boolean recommendSty;
       ArrayList templateGrou;
       int b2;
       o2 oo2;
       c n;
       double d1;
       double d2;
       List mId1;
       Iterator mId1;
       a uoa;
       GeneratedMessageLite$Builder mId11;
       Boolean this2;
       double d4;
       o0 mId2;
       float f;
       a uoa1;
       GeneratedMessageLite$Builder uBuilder1;
       a obj3;
       PatchProxyResult patchProxyRe2;
       a uoa2;
       o oo4;
       Iterator iterator1;
       Asset$PositionType oPENING;
       Iterator iterator2;
       List obj4;
       List list1;
       Iterator iterator3;
       File uFile;
       o oo = this;
       Object obj = p0;
       String obj1 = p1;
       boolean b = p2;
       boolean b1 = p3;
       u ou = u.class;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       o oo1 = o.class;
       if (PatchProxy.isSupport(oo1) && PatchProxy.applyVoidFourRefs(p0, p1, Boolean.valueOf(p2), Boolean.valueOf(p3), this, o.class, "18")) {
          return;
       }
       String str = "draft";
       a.p(obj, str);
       a.p(obj1, "template");
       String str1 = ", isUserSave = ";
       this = ", commit = ";
       Object[] objArray = new Object[0];
       String str2 = "KwaiAICutProject";
       g.D().w(str2, "saveTemplateToDraft\(\) called with: draft = "+obj+','+" template = "+obj1+str1+b+this+b1, objArray);
       if (p0.b1() == Workspace$Type.UNKNOWN) {
          GeneratedMessageLite$Builder uBuilder = p0.k();
          a.o(uBuilder, "draft.ensureFirstBuilder\(\)");
          uBuilder.u(p0.a1());
       }
       long l = System.currentTimeMillis();
       String str3 = "asset";
       if (a.c(p0).E()) {
          EditorSdk2V2$VideoEditorProject videoEditorP = oo.g.a0();
          str4 = this;
          if (!PatchProxy.applyVoidTwoRefs(obj, videoEditorP, null, n0.class, "20")) {
             uoa = p0.o0();
             if (uoa != null) {
                uoa.d();
                uoa.c0();
                c.a(videoEditorP, uoa);
                uoa.g(false);
             }
          }
          size = PatchProxy.applyTwoRefs(oo.g.M(), obj1, oo, oo1, "21");
          if (size != patchProxyRe) {
          }else if(p1.getAiCutStyle().mDpi != 1){
             this1 = false;
             if (!a.t().d("annualAlbumDPI", this1)) {
                size = new Size(1080, 1920);
             }
          }else {
             this1 = 0;
          }
          objArray2 = new Object[this1];
          g.D().w(str2, "calculatePreviewSize: dpi use 720", objArray2);
          size = new Size(720, 1280);
          e0.p(obj, size, b1);
       }else {
          str4 = this;
          d uod1 = d.class;
          if (PatchProxy.isSupport(uod1)) {
             if (!PatchProxy.applyVoidTwoRefs(obj, Boolean.valueOf(p3), null, uod1, "2")) {
             }
          }else {
             obj4 = null;
          }
       }
       String str5 = str3;
       String str6 = 1;
    label_01a0 :
       if (p0.a1() == Workspace$Type.KUAISHAN && oo.g.I0() != null) {
          List list = oo.g.M();
          if (!PatchProxy.applyVoidTwoRefs(list, obj, oo, oo1, "44")) {
             a uoa5 = p0.o0();
             if (uoa5 == null) {
                PostUtils.D(str2, "updateAssetDraftAlbmId\(\) no assetDraft", new IllegalArgumentException());
             }else if(list.size() != uoa5.z().size()){
                PostUtils.D(str2, "updateAssetDraftAlbmId\(\) assetDraft size="+uoa5.z().size()+", qMedias size="+list.size(), new IllegalArgumentException());
             }else if(!uoa5.D()){
                uoa5.c0();
             }
             Iterator iterator = list.iterator();
             this1 = 0;
             while (iterator.hasNext()) {
                obj4 = iterator.next();
                int i5 = this1 + 1;
                if (this1 < 0) {
                   CollectionsKt__CollectionsKt.W();
                }
                mId11 = uoa5.n(this1);
                a.o(mId11, "assetDraft.getBuilder\(index\)");
                mId11.d(obj4.path);
                this1 = i5;
                iterator1 = 1;
             }
             uoa5.g(false);
          label_0249 :
             g = oo.g;
             String str7 = "";
             int i = 4;
             if (g instanceof AICutAnnualMemoryProject) {
                oo2 = g;
                if (PatchProxy.isSupport(oo1)) {
                   ou1 = ou;
                   str8 = 1;
                   str9 = str5;
                   str10 = str2;
                   str11 = str4;
                   str12 = str1;
                   if (PatchProxy.applyVoidFourRefs(p0, Boolean.valueOf(p3), oo2, Boolean.valueOf(p2), this, o.class, "20")) {
                   label_03ee :
                      str13 = str10;
                      i1 = 0;
                   }else {
                   label_0299 :
                      uoa1 = p0.o0();
                      if (uoa1 != null) {
                         uoa1.d();
                         if (b1) {
                            uoa1.c0();
                         }
                         iterator1 = oo2.W0().iterator();
                         while (iterator1.hasNext()) {
                            b uob4 = iterator1.next();
                            GeneratedMessageLite$Builder uBuilder4 = uoa1.b();
                            a.o(uBuilder4, "assetDraft.append\(\)");
                            if (uob4.d() == KSMemoryClipType.OPENING) {
                               oPENING = Asset$PositionType.OPENING;
                            }else if(uob4.d() == KSMemoryClipType.ENDING){
                               oPENING = Asset$PositionType.ENDING;
                            }else if(uob4.e().size() > str8){
                               oPENING = Asset$PositionType.SPLIT;
                            }else {
                               oPENING = Asset$PositionType.NORMAL;
                            }
                            str1 = uob4.d().getAssetTag();
                            if (str1 == null) {
                               str1 = str7;
                            }
                            uBuilder4.m(str1);
                            uBuilder4.copyOnWrite();
                            uBuilder4.instance.setPositionType(oPENING);
                            TimeRange$b oPENING1 = TimeRange.newBuilder();
                            oPENING1.a(uob4.d);
                            uBuilder4.s(oPENING1.build());
                            mId1 = uob4.c();
                            if (mId1 != null) {
                               mId1 = mId1.iterator();
                               while (mId1.hasNext()) {
                                  a uoa4 = mId1.next();
                                  AEEffect$b uob5 = AEEffect.newBuilder();
                                  String str15 = uoa4.b();
                                  str8 = (str15 != null)? str15: str7;
                                  uob5.copyOnWrite();
                                  iterator2 = iterator1;
                                  uob5.instance.setTemplateId(str8);
                                  str6 = uoa4.a();
                                  if (str6 == null) {
                                     str6 = str7;
                                  }
                                  uob5.copyOnWrite();
                                  uob5.instance.addTexts(str6);
                                  uoa = uoa4.c;
                                  if (uoa != null) {
                                     uob5.copyOnWrite();
                                     uob5.instance.addTextPicturePath(uoa1.Q(uoa));
                                  }
                                  uBuilder4.copyOnWrite();
                                  uBuilder4.instance.addAe2Effects(uob5);
                                  iterator1 = iterator2;
                                  str8 = 1;
                               }
                            }
                            iterator2 = iterator1;
                            if (uob4.e().size() > 1) {
                               iterator1 = uob4.e().iterator();
                               while (iterator1.hasNext()) {
                                  Asset$b mId12 = Asset.newBuilder();
                                  c.c(uoa1, mId12, iterator1.next(), Boolean.TRUE);
                                  uBuilder4.copyOnWrite();
                                  uBuilder4.instance.addSubAsset(mId12);
                               }
                            }else if(uob4.e().size() == 1){
                               a.o(c.b(uoa1, uBuilder4, uob4.e().get(0)), "AssetDraftGenerateUtils.¡­templateMedia.mMedias[0]\)");
                            }else {
                               objArray = new Object[0];
                               g.D().t(str10, "saveAnnualAlbumAssetToDraft: templateMedia.mMedias.size=0", objArray);
                            }
                            iterator1 = iterator2;
                            str8 = 1;
                         }
                         str13 = str10;
                         i1 = 0;
                         if (b1) {
                            uoa1.g(b);
                         }
                      }else {
                         goto label_03ee ;
                      }
                   }
                }else {
                   str10 = str2;
                   str12 = str1;
                   ou1 = ou;
                   str11 = str4;
                   str9 = str5;
                   str8 = 1;
                   goto label_0299 ;
                }
                o oo3 = oo.g;
                this1 = 5;
                if (PatchProxy.isSupport(oo1)) {
                   objArray1 = new Object[this1];
                   objArray1[i1] = obj;
                   objArray1[1] = obj1;
                   objArray1[2] = Boolean.valueOf(p3);
                   objArray1[3] = Boolean.valueOf(p2);
                   objArray1[i] = oo3;
                   if (PatchProxy.applyVoid(objArray1, oo, oo1, "19")) {
                      str14 = str13;
                      patchProxyRe1 = patchProxyRe;
                   label_050f :
                      i2 = 5;
                   }
                }
                obj3 = a.f(p0);
                obj3.d();
                m a1 = m.a;
                KwaiAICutStyle mCoverFrameT = p1.getAiCutStyle().mCoverFrameTime;
                Objects.requireNonNull(a1);
                if (PatchProxy.isSupport(m.class)) {
                   patchProxyRe2 = patchProxyRe;
                   aiCutStyle = mCoverFrameT;
                   uoa2 = obj3;
                   i2 = 5;
                   oo4 = oo3;
                   str14 = str13;
                   if (!PatchProxy.applyVoidFourRefs(p0, Double.valueOf(mCoverFrameT), Boolean.valueOf(p3), Boolean.valueOf(p2), a1, m.class, "9")) {
                   label_0472 :
                      a.p(obj, str);
                      objArray3 = new Object[0];
                      f.D().w("CoverDraftUtils", "saveCoverPositionToDraft: coverTime="+aiCutStyle, objArray3);
                      uoa1 = a.f(p0);
                      if (b1) {
                         uoa1.c0();
                      }
                      uoa1.l(new l(aiCutStyle));
                      if (b1) {
                         uoa1.g(b);
                      }
                   }
                }else {
                   uoa2 = obj3;
                   oo4 = oo3;
                   str14 = str13;
                   patchProxyRe2 = patchProxyRe;
                   i2 = 5;
                   aiCutStyle = mCoverFrameT;
                   goto label_0472 ;
                }
                id = p1.getId();
                Objects.requireNonNull(oo4);
                o oo5 = oo4;
                c uoc = PatchProxy.applyOneRefs(id, oo5, AICutAnnualMemoryProject.class, "18");
                patchProxyRe1 = patchProxyRe2;
                if (uoc != patchProxyRe1) {
                }else {
                   a.p(id, "templateId");
                   AICutAnnualMemoryProject$a uoa3 = oo5.b0.get(id);
                   if (uoa3 != null) {
                      n = uoa3.b();
                      if (n != null) {
                         uoc = n.d;
                      }
                   }
                   uoc = null;
                }
                if (uoc != null && new File(uoc).exists()) {
                   ImportCoverParamV2$b uob3 = ImportCoverParamV2.newBuilder();
                   uob3.c(true);
                   uob3.a(uoa2.Q(uoc));
                   uob3.b(uoc);
                   uoa2.k().b(uob3);
                }
             }else {
                str14 = str2;
                str12 = str1;
                ou1 = ou;
                patchProxyRe1 = patchProxyRe;
                str11 = str4;
                str9 = str5;
                goto label_050f ;
             }
             this1 = new Object[0];
             str8 = "AnnualMemoryTimeCost";
             g.D().w(str8, "Asset±£´æ²Ý¸åºÄÊ±£º"+(System.currentTimeMillis() - l), this1);
             Music music = n.f.c(p1.getId());
             if (music != null) {
                id = music.getId();
                if (id != null) {
                label_0548 :
                   str13 = "workspaceDraft";
                   if (!TextUtils.n(id, p0.K0())) {
                      long l1 = System.currentTimeMillis();
                      if (PatchProxy.isSupport(ou1)) {
                         objArray1 = new Object[]{obj,music,Boolean.valueOf(p2),Boolean.valueOf(p3),oobject,Boolean.valueOf(1)};
                         oobject = null;
                         this11 = ou1;
                         if (!PatchProxy.applyVoid(objArray1, oobject, this11, "1")) {
                         label_058b :
                            a.p(obj, str13);
                            n = p0.J0();
                            if (n != null) {
                               if (b1) {
                                  n.c0();
                               }
                               Music music1 = n.v();
                               Float uFloat = (music1 != null)? Float.valueOf(music1.getVolume()): oobject;
                               u.k(false, n);
                               obj3 = PatchProxy.applyOneRefs(music, oobject, o.class, "14");
                               if (obj3 != patchProxyRe1) {
                                  recommendSty = obj3.booleanValue();
                               }else if(music != null && (!TextUtils.x(music.mId) || !TextUtils.x(music.mName))){
                                  recommendSty = true;
                               }else {
                                  recommendSty = false;
                               }
                               if (recommendSty) {
                                  a.m(music);
                                  GeneratedMessageLite$Builder uBuilder3 = n.b();
                                  a.o(uBuilder3, "musicDraft.append\(\)");
                                  u.n(music, uBuilder3, n, null, Music$Source.EDIT, null, null, null, null, null, false, 1896, null);
                                  if (uFloat != null) {
                                     Music$b uob2 = u.a.b(n);
                                     if (uob2 != null) {
                                        uob2.p(uFloat.floatValue());
                                     }
                                  }
                               }
                               if (b1) {
                                  n.g(b);
                               }
                            }
                         }
                      }else {
                         this11 = ou1;
                         oobject = null;
                         goto label_058b ;
                      }
                      if (PatchProxy.isSupport(oo1)) {
                         ou1 = this11;
                         obj1 = str13;
                         if (!PatchProxy.applyVoidFourRefs(music, p0, Boolean.valueOf(p3), Boolean.valueOf(p2), this, o.class, "23")) {
                         label_0641 :
                            n = a.n(p0);
                            if (b1) {
                               n.c0();
                            }
                            Music$b uob1 = u.a.b(n);
                            if (music != null && uob1 != null) {
                               d.a(0x2be267d).FV(music, uob1, obj);
                            }
                            if (b1) {
                               n.g(b);
                            }
                         }
                      }else {
                         ou1 = this11;
                         obj1 = str13;
                         goto label_0641 ;
                      }
                      w6.b(music);
                      a = u.a;
                      Objects.requireNonNull(a);
                      d = 2.00f;
                      if (PatchProxy.isSupport(ou1)) {
                         objArray2 = new Object[]{obj,Boolean.valueOf(p2),Boolean.valueOf(p3),Double.valueOf(d),Double.valueOf(d)};
                         if (!PatchProxy.applyVoid(objArray2, a, ou1, "17")) {
                         label_069f :
                            a.p(obj, str);
                            n = a.n(p0);
                            if (!n.p()) {
                               objArray = new Object[0];
                               f.D().w("MusicDraftUtil", "saveMusicFadeTime: no music", objArray);
                            }else if(b1){
                               n.c0();
                            }
                            int i4 = n.p();
                            this1 = 0;
                            while (this1 < i4) {
                               GeneratedMessageLite$Builder uBuilder2 = n.n(this1);
                               a.o(uBuilder2, "musicDraft.getBuilder\(i\)");
                               if (uBuilder2.getType() != Music$Type.RECORD && uBuilder2.getType() != Music$Type.MEDIA_SCENE_IMPORT) {
                                  uBuilder2.f(d);
                                  a.o(uBuilder2, "builder.setFadeInTime\(fadeIn\)");
                                  uBuilder2.g(d);
                               }
                               this1++;
                            }
                            if (b1) {
                               n.g(b);
                            }
                         }
                      }else {
                         goto label_069f ;
                      }
                      objArray3 = new Object[0];
                      g.D().w(str8, "ÒôÀÖ²Ý¸å±£´æºÄÊ±£º"+(System.currentTimeMillis() - l1), objArray3);
                   }else {
                      obj1 = str13;
                   }
                   if (!p1.getType()) {
                      n0.h(obj, oo.g.M(), b1, b);
                      aiCutStyle = p1.getAiCutStyle();
                      if (PatchProxy.isSupport(oo1) && PatchProxy.applyVoidFourRefs(p0, aiCutStyle, Boolean.valueOf(p2), Boolean.valueOf(p3), this, o.class, "22")) {
                         obj1 = str14;
                      }else {
                         str6 = aiCutStyle.getId();
                         a.o(str6, "style.id");
                         music = n.f.c(str6);
                         oo2 = oo.g.Y().get(aiCutStyle.getId());
                         long l2 = (oo2 != null)? oo2.c(): null;
                         long l3 = l2;
                         g og = g.D();
                         str6 = "saveInfoToDraft: "+aiCutStyle+" music id=";
                         Music mId = (music != null)? music.mId: null;
                         Object[] objArray4 = new Object[0];
                         str13 = str14;
                         og.w(str13, str6+mId, objArray4);
                         n = oo.g.n;
                         Asset obj2 = null;
                         if (!PatchProxy.applyVoidTwoRefs(obj, n, obj2, j.class, "6")) {
                            a.p(obj, obj1);
                            a.p(n, "smartAlbumId");
                            if (p0.a1() != Workspace$Type.ALBUM_MOVIE) {
                               this1 = new Object[0];
                               a.D().w("AICutBaseUtils", "saveSmartAlbumIdToDraft: illegal invoke", this1);
                            }else if(!TextUtils.x(n)){
                               uBuilder1 = p0.k();
                               a.o(uBuilder1, "workspaceDraft.ensureFirstBuilder\(\)");
                               uBuilder1.i(n);
                            }
                         }
                         j.r(p0, aiCutStyle, l3, p2, p3);
                         mId = 0x3ff0000000000000;
                         if (PatchProxy.isSupport(oo1)) {
                            d1 = mId;
                            if (PatchProxy.applyVoidThreeRefs(p0, Boolean.valueOf(p3), Boolean.valueOf(p2), this, o.class, "25")) {
                               d2 = d1;
                               b = p2;
                               obj1 = str13;
                            }else {
                            label_0816 :
                               list = a.c(p0).z();
                               a.o(list, "assets");
                               iterator = list.iterator();
                               while (true) {
                                  if (iterator.hasNext()) {
                                     Asset uAsset = iterator.next();
                                     a.o(uAsset, "it");
                                     if (uAsset.getIsVocal()) {
                                        this2 = 1;
                                     }
                                  }else {
                                     this2 = null;
                                  }
                                  if (!oo.g.O() - 0xbff0000000000000) {
                                     if (this2) {
                                        oo.g.q0(d1);
                                        d4 = oo.g.O();
                                     }else if(a.n(p0).p()){
                                        mId2 = null;
                                     }else {
                                        double mId3 = d1;
                                     }
                                     d4 = mId2;
                                  }else {
                                     d4 = oo.g.O();
                                  }
                                  mId2 = o0.a;
                                  f = (float)d4;
                                  Objects.requireNonNull(mId2);
                                  if (PatchProxy.isSupport(o0.class)) {
                                     obj1 = str13;
                                     if (!PatchProxy.applyVoidFourRefs(p0, Float.valueOf(f), Boolean.valueOf(p3), Boolean.valueOf(p2), mId2, o0.class, "2")) {
                                     label_089b :
                                        a.p(obj, str);
                                        uoa1 = p0.g1();
                                        if (uoa1 != null) {
                                           if (b1) {
                                              uoa1.c0();
                                           }
                                           uBuilder1 = uoa1.k();
                                           a.o(uBuilder1, "voiceDraft.ensureFirstBuilder\(\)");
                                           uBuilder1.d(f);
                                           if (b1) {
                                              b = p2;
                                              d2 = 0x3ff0000000000000;
                                              uoa1.g(b);
                                           }
                                        }
                                     }
                                  }else {
                                     obj1 = str13;
                                     goto label_089b ;
                                  }
                                  b = p2;
                                  d2 = 0x3ff0000000000000;
                               }
                            }
                         }else {
                            d1 = mId;
                            goto label_0816 ;
                         }
                         if (PostExperimentUtils.M0()) {
                            Music mMusicBeatsS = (music != null)? music.mMusicBeatsString: null;
                            if (!TextUtils.x(mMusicBeatsS) && w6.a()) {
                               a.m(music);
                               Objects.requireNonNull(w6.a);
                               a.p(obj, str);
                               a.p(music, "music");
                               objArray4 = new Object[0];
                               p3.D().w("PostMusicUtils", "applyMusicBeatsAndSave\(\) called with: draft = "+obj+','+" music = "+music+str11+b1+str12+b, objArray4);
                               templateGrou = new ArrayList();
                               ArrayList uArrayList = new ArrayList();
                               mId1 = a.c(p0).z();
                               a.o(mId1, "getAssetDraft\(draft\).messages");
                               mId1 = mId1.iterator();
                               while (mId1.hasNext()) {
                                  obj2 = mId1.next();
                                  a.o(obj2, str9);
                                  templateGrou.add(obj2.getAlbumId());
                                  String albumId = obj2.getAlbumId();
                                  double duration = obj2.getDuration();
                                  TimeRange selectedRang = obj2.getSelectedRange();
                                  a.o(selectedRang, "asset.selectedRange");
                                  TimeRange selectedRang1 = obj2.getSelectedRange();
                                  a.o(selectedRang1, "asset.selectedRange");
                                  ProjectItem projectItem = new ProjectItem(albumId, EditorSdk2UtilsV2.isSingleImagePath(obj2.getAlbumId()), duration, selectedRang.getStart(), selectedRang1.getDuration());
                                  uArrayList.add(aiCutStyle);
                               }
                               boolean b3 = false;
                               double d3 = ((double)LongVideoLocalProject.e(b3) * d2) / (double)1000;
                               VideoContext videoContext = p0.d1();
                               int i3 = (templateGrou.size() == 1 && EditorSdk2UtilsV2.isSingleImagePath(templateGrou.get(b3)))? 1: 0;
                               if (videoContext != null) {
                                  i3 = (i3 && videoContext.j() == 1)? 1: 0;
                               }
                            label_09c2 :
                               i3 = (i3)? 8: 4;
                               ProjectItem[] projectItemA = new ProjectItem[0];
                               objArray2 = uArrayList.toArray(projectItemA);
                               Objects.requireNonNull(objArray2, "null cannot be cast to non-null type kotlin.Array<T>");
                               Object[] objArray5 = objArray2;
                               ProjectItem[] projectItemA1 = SmartEditTask.changeMusic(objArray5, d3, music.mMusicBeatsString, (double)((float)music.mChorus / 1000.00f), (double)music.mDuration, (double)i3);
                               uoa = a.c(p0);
                               if (b1) {
                                  uoa.c0();
                               }
                               a.o(projectItemA1, "result");
                               b2 = projectItemA1.length;
                               for (recommendSty = 0; recommendSty < b2; recommendSty++) {
                                  mId11 = uoa.n(recommendSty);
                                  a.o(mId11, "assetDraft.getBuilder\(i\)");
                                  oobject = projectItemA1[recommendSty];
                                  TimeRange$b uob = TimeRange.newBuilder();
                                  a.o(oobject, "track");
                                  uob.b(oobject.getClipStartPoint());
                                  uob.a(oobject.getClipDuration());
                                  mId11.s(uob.build());
                               }
                               if (b1) {
                                  uoa.g(b);
                               }
                            }
                         }
                      }
                   }else {
                      obj1 = str14;
                      if (!PatchProxy.isSupport(oo1) || !PatchProxy.applyVoidFourRefs(p1, p0, Boolean.valueOf(p2), Boolean.valueOf(p3), this, o.class, "24")) {
                         g = oo.g;
                         Objects.requireNonNull(g, "null cannot be cast to non-null type com.yxcorp.gifshow.aicutv2.VideoTemplateProject");
                         d uod = g.I0();
                         if (uod != null) {
                            d.a(-711186681).s50(p0, uod, p2, p3, KSSource.AI_CUT);
                         }
                      }
                   }
                   AICutTheme uAICutTheme = a.a(p0).v();
                   recommendSty = (uAICutTheme != null)? uAICutTheme.getRecommendStyleCount(): 0;
                   if (recommendSty) {
                      uAICutTheme = a.a(p0).v();
                      recommendSty = (uAICutTheme != null)? uAICutTheme.getNewRecommendStyleCount(): 0;
                      if (!recommendSty) {
                      label_0aa5 :
                         VideoTemplateResponse videoTemplat = oo.g.M0();
                         if (videoTemplat != null) {
                            templateGrou = videoTemplat.getTemplateGroups();
                            if (templateGrou != null) {
                               objArray = new Object[0];
                               g.D().w(obj1, "saveTemplateToDraft: saveRecommendStyles ", objArray);
                               iterator = templateGrou.iterator();
                               while (iterator.hasNext()) {
                                  VideoTemplateGroupInfo videoTemplat1 = iterator.next();
                                  str2 = "ÍÆ¼ö";
                                  if (g7.a(p0)) {
                                     if (a.g(videoTemplat1.getGroupName(), "ÈÈÃÅ")) {
                                        j.u(j.d, p0, videoTemplat1.getTemplates(), false, 4, null);
                                        break ;
                                     }else if(a.g(videoTemplat1.getGroupName(), str2)){
                                        j.d.t(obj, videoTemplat1.getTemplates(), true);
                                        break ;
                                     }
                                  }else if(a.g(videoTemplat1.getGroupName(), str2) || oo.g instanceof AICutAnnualMemoryProject){
                                     j.u(j.d, p0, videoTemplat1.getTemplates(), false, 4, null);
                                     break ;
                                  }else {
                                     continue ;
                                  }
                                  b2 = true;
                               }
                            }
                         }
                      }
                   }else {
                      goto label_0aa5 ;
                   }
                   return;
                }
             }
             id = str7;
             goto label_0548 ;
          }
       }
       this = null;
       goto label_0249 ;
    }
    public final void p(c p0){
       i d;
       boolean isRecommend;
       int i1;
       MusicSource tEMPLATE;
       VideoContext a;
       o oo = o.class;
       if (PatchProxy.applyVoidOneRefs(p0, this, oo, "27")) {
          return;
       }
       a.p(p0, "workspaceDraft");
       VideoContext videoContext = p0.d1();
       String str = "workspaceDraft.videoContext";
       a.o(videoContext, str);
       boolean b = true;
       String str1 = j.d(p0, b);
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       if (!PatchProxy.applyVoidTwoRefs(videoContext, str1, this, oo, "30")) {
          Objects.requireNonNull(videoContext);
          if (PatchProxy.apply(null, videoContext, VideoContext.class, "36") != patchProxyRe) {
          }else {
             VideoContext.b();
             Log.g("VideoContext", "clearEditMusic");
             a = videoContext.a;
             a.b.y = 0;
             a.d.i = null;
             videoContext.b2();
          }
          n f = n.f;
          Music music = (str1 != null)? f.c(str1): f.b();
          if (music != null) {
             Object[] objArray = new Object[false];
             g.D().w("KwaiAICutProject", "saveMusicToVideoContext: "+music.mName, objArray);
             Object obj = PatchProxy.applyOneRefs(str1, this, oo, "31");
             if (obj != patchProxyRe) {
                i1 = obj.intValue();
             }else if(!TextUtils.x(str1) && (a.g(str1, "-1") ^ b)){
                tEMPLATE = MusicSource.TEMPLATE;
             }else {
                tEMPLATE = MusicSource.CLOUD_MUSIC;
             }
             i1 = tEMPLATE.getValue();
             videoContext.Q0(i1);
             videoContext.P0(music);
             videoContext.R0((int)(this.g.N() * (double)100));
          }
       }
       if (!PatchProxy.applyVoidOneRefs(p0, this, oo, "28")) {
          videoContext = p0.d1();
          a.o(videoContext, str);
          if (p0.b1() != Workspace$Type.UNKNOWN) {
             str = j.d(p0, b);
             if (g7.a(p0)) {
                d = videoContext.F().d;
                e$t ot = new e$t();
                ot.a = str;
                AICutTheme uAICutTheme = a.a(p0).v();
                isRecommend = (uAICutTheme != null)? uAICutTheme.getIsRecommend(): false;
                ot.b = isRecommend;
                d.T = ot;
             }
             Workspace$Type type = p0.a1();
             if (type == null) {
             label_0123 :
                j.d.a(videoContext);
                videoContext.F().b.I = null;
                isRecommend = (p0.b1() == Workspace$Type.LONG_VIDEO)? true: false;
                videoContext.m1(isRecommend);
             }else {
                isRecommend = p.b[type.ordinal()];
                if (isRecommend != b && isRecommend != 2) {
                   int i = -711186681;
                   if (isRecommend != 3) {
                      if (isRecommend != 4) {
                         goto label_0123 ;
                      }else if(g7.a(p0)){
                         j.d.b(videoContext);
                         videoContext.F().b.I = null;
                         this.m(videoContext, false);
                         d uod = this.g.I0();
                         if (uod != null) {
                            d.a(i).pw(p0, uod, KSSource.AI_CUT);
                         }
                         videoContext.m1(false);
                      }else {
                         j.d.a(videoContext);
                         videoContext.F().b.I = null;
                         videoContext.m1(false);
                      }
                   }else {
                      j.d.b(videoContext);
                      videoContext.m1(false);
                      if (p0.b1() != Workspace$Type.ALBUM_MOVIE) {
                         d uod1 = this.g.I0();
                         if (uod1 != null) {
                            d.a(i).pw(p0, uod1, KSSource.AI_CUT);
                         }
                      }
                   }
                }else if(p0.b1() == Workspace$Type.VIDEO || p0.b1() == Workspace$Type.LONG_VIDEO){
                   isRecommend = true;
                }else {
                   isRecommend = false;
                }
                this.m(videoContext, isRecommend);
                j.d.b(videoContext);
                videoContext.F().b.I = null;
                videoContext.m1(false);
             }
             if (!PatchProxy.applyVoidOneRefs(p0, this, oo, "33")) {
                String str2 = j.d(p0, b);
                if (p0.a1() != Workspace$Type.KUAISHAN) {
                   b = 0;
                }
                videoContext = p0.d1();
                a.o(videoContext, "draft.videoContext");
                if (videoContext.G().b.S0 == null) {
                   videoContext = p0.d1();
                   a.o(videoContext, "draft.videoContext");
                   videoContext.G().b.S0 = new m$l0();
                }
                VideoContext videoContext1 = p0.d1();
                a.o(videoContext1, "draft.videoContext");
                m$k0 s0 = videoContext1.G().b.S0;
                s0.c = str2;
                s0.d = b;
             }
          }
       }
       return;
    }
    public final void q(){
       o g;
       Pair pair1;
       String second1;
       Iterator iterator;
       List list;
       List list1;
       Object[] objArray1;
       KSMemoryClipType cOMMON;
       b obj;
       Object obj1;
       double d;
       double d1;
       boolean b = this;
       o oo = o.class;
       if (PatchProxy.applyVoid(null, b, oo, "41")) {
          return;
       }
       boolean b1 = true;
       Pair pair = b.k(b1);
       boolean b2 = false;
       b.a = b.k(b2).getFirst().booleanValue();
       if (pair.getFirst().booleanValue()) {
          Object[] objArray = new Object[b2];
          String str = "KwaiAICutProject";
          g.D().w(str, "updateMediaListIfNeed: has changed", objArray);
          g = b.g;
          if (g instanceof AICutAnnualMemoryProject) {
             String second = pair.getSecond();
             a.m(second);
             ArrayList uArrayList = PatchProxy.applyOneRefs(second, b, oo, "43");
             if (uArrayList != PatchProxyResult.class) {
                pair1 = pair;
             }else {
                oo = b.b;
                String str1 = "getKSMemoryMedia";
                if (oo != null) {
                   ArrayList uArrayList1 = new ArrayList();
                   list1 = a.c(oo).z();
                   a.o(list1, "DraftGetUtils.getAssetDraft\(draft\).messages");
                   iterator = list1.iterator();
                   while (iterator.hasNext()) {
                      Asset uAsset = iterator.next();
                      a.o(uAsset, "asset");
                      Asset$PositionType positionType = uAsset.getPositionType();
                      if (positionType == null) {
                      label_009e :
                         cOMMON = KSMemoryClipType.COMMON;
                      }else {
                         int i = p.d[positionType.ordinal()];
                         if (i != b1) {
                            if (i != 2) {
                               goto label_009e ;
                            }else {
                               cOMMON = KSMemoryClipType.ENDING;
                            }
                         }else {
                            cOMMON = KSMemoryClipType.OPENING;
                         }
                      }
                      KSMemoryClipType kSMemoryClip = cOMMON;
                      ArrayList uArrayList2 = new ArrayList();
                      if (!uAsset.getSubAssetCount()) {
                         Iterator iterator2 = second.iterator();
                         while (true) {
                            if (iterator2.hasNext()) {
                               obj = iterator2.next();
                               if (a.g(uAsset.getAlbumId(), obj.mAlbum)) {
                               label_00d4 :
                                  if (obj == null) {
                                     PostUtils.D(str, str1, new RuntimeException("find no media"+' '+kSMemoryClip.getAssetTag()));
                                     second1 = null;
                                  }else {
                                     CropOptions cropOptions = uAsset.getCropOptions();
                                     a.o(cropOptions, "asset.cropOptions");
                                     obj.mWidth = cropOptions.getWidth();
                                     cropOptions = uAsset.getCropOptions();
                                     a.o(cropOptions, "asset.cropOptions");
                                     obj.mHeight = cropOptions.getHeight();
                                     TimeRange selectedRang = uAsset.getSelectedRange();
                                     String str2 = "asset.selectedRange";
                                     a.o(selectedRang, str2);
                                     double start = selectedRang.getStart();
                                     obj1 = second;
                                     d = (double)1000.00f;
                                     pair1 = pair;
                                     d1 = start * d;
                                     obj.mClipStart = (long)d1;
                                     TimeRange selectedRang1 = uAsset.getSelectedRange();
                                     a.o(selectedRang1, str2);
                                     d1 = selectedRang1.getDuration() * d;
                                     obj.mClipDuration = (long)d1;
                                     uArrayList2.add(obj);
                                  }
                               }else {
                                  second1 = null;
                               }
                            }else {
                               obj = 0;
                               goto label_00d4 ;
                            }
                         }
                      }else {
                         pair1 = pair;
                         obj1 = second;
                      }
                      if (!uArrayList2.isEmpty()) {
                         List ae2EffectsLi = uAsset.getAe2EffectsList();
                         a.o(ae2EffectsLi, "asset.ae2EffectsList");
                         ArrayList uArrayList3 = new ArrayList(u.Y(ae2EffectsLi, 10));
                         Iterator iterator3 = ae2EffectsLi.iterator();
                         while (iterator3.hasNext()) {
                            AEEffect uAEEffect = iterator3.next();
                            a.o(uAEEffect, "it");
                            second = uAEEffect.getTemplateId();
                            List textsList = uAEEffect.getTextsList();
                            a.o(textsList, "it.textsList");
                            List textPictureP = uAEEffect.getTextPicturePathList();
                            a.o(textPictureP, "it.textPicturePathList");
                            uArrayList3.add(new a(second, CollectionsKt___CollectionsKt.p2(textsList), CollectionsKt___CollectionsKt.p2(textPictureP)));
                         }
                         obj = new b(uArrayList2, uArrayList3, kSMemoryClip, uAsset.getDuration());
                         uArrayList1.add(iterator3);
                      }
                      pair = pair1;
                      second = obj1;
                      d1 = Double.MIN_VALUE;
                      d = 0;
                      continue ;
                   }
                   pair1 = pair;
                   uArrayList = uArrayList1;
                }else {
                   pair1 = pair;
                   PostUtils.D(str, str1, new RuntimeException("return empty list"));
                   list1 = CollectionsKt__CollectionsKt.E();
                }
             }
             o g1 = b.g;
             second1 = pair1.getSecond();
             a.m(second1);
             Objects.requireNonNull(g1);
             if (!PatchProxy.applyVoidTwoRefs(uArrayList, second1, g1, AICutAnnualMemoryProject.class, "2")) {
                a.p(uArrayList, "ksMedias");
                a.p(second1, "medias");
                g1.f0.clear();
                g1.f0.addAll(uArrayList);
                g1.Y.clear();
                iterator = g1.f0.iterator();
                while (iterator.hasNext()) {
                   b uob = iterator.next();
                   if (uob.d() != KSMemoryClipType.COMMON && (uob.d() == KSMemoryClipType.OPENING || uob.d() == KSMemoryClipType.ENDING)) {
                      g1.Y.add(uob);
                   }else {
                      Iterator iterator1 = uob.e().iterator();
                      while (iterator1.hasNext()) {
                         list = Collections.singletonList(iterator1.next());
                         a.o(list, "Collections.singletonList\(it\)");
                         b uob1 = new b(list, null, KSMemoryClipType.COMMON, uob.getClipDuration());
                         g1.Y.add(str);
                      }
                   }
                }
                list1 = g1.M();
                Objects.requireNonNull(list1, "null cannot be cast to non-null type kotlin.collections.MutableList<com.yxcorp.gifshow.models.QMedia>");
                list1 = s0.g(list1);
                list1.clear();
                list1.addAll(second1);
                g1.X0();
                objArray1 = new Object[0];
                g.D().w("AICutAnnualMemoryProject", "updateKSMedia: templateMedias="+g1.f0.size()+"originTemplateMedias="+g1.Y.size()+" medias="+second1.size(), objArray1);
             }
          }else {
             list1 = pair.getSecond();
             Objects.requireNonNull(g);
             if (!PatchProxy.applyVoidOneRefs(list1, g, VideoTemplateProject.class, "1") && list1 != null) {
                List list2 = g.M();
                Objects.requireNonNull(list2, "null cannot be cast to non-null type kotlin.collections.MutableList<com.yxcorp.gifshow.models.QMedia>");
                list2 = s0.g(list2);
                list2.clear();
                list2.addAll(list1);
                objArray1 = new Object[0];
                g.D().w("VideoTemplateProject", "updateMedias: "+list1.size(), objArray1);
             }
          }
       }
       return;
    }
}
