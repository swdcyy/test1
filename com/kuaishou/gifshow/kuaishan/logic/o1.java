package com.kuaishou.gifshow.kuaishan.logic.o1;
import u80.d;
import t36.f;
import com.yxcorp.gifshow.kuaishan.model.KSTemplateDetailInfo;
import java.lang.String;
import com.kwai.video.editorsdk2.EditorSdk2Utils$PreviewSizeLimitation;
import java.util.LinkedList;
import h90.d;
import java.lang.Object;
import java.lang.Class;
import com.kwai.robust.PatchProxy;
import com.kwai.robust.PatchProxyResult;
import java.lang.Boolean;
import java.util.List;
import java.util.Iterator;
import h90.e;
import java.lang.CharSequence;
import com.yxcorp.utility.TextUtils;
import java.lang.Number;
import java.util.Objects;
import java.util.Set;
import java.util.Map;
import u80.e;
import java.lang.StringBuilder;
import w46.b;
import com.kwai.video.clipkit.mv.KwaiMvParam;
import com.kwai.video.clipkit.mv.EditorSdk2MvCreationResult;
import com.kwai.video.clipkit.mv.ClipMvUtils;
import java.lang.Throwable;
import com.yxcorp.gifshow.util.PostUtils;
import q87.c;
import com.yxcorp.gifshow.models.QMedia;
import com.kwai.video.minecraft.model.EditorSdk2V2$VideoEditorProject;
import com.kwai.video.minecraft.model.nano.Minecraft$Color;
import wba.d;
import com.kwai.video.minecraft.model.EditorSdk2UtilsV2;
import java.util.LinkedHashMap;
import com.kwai.video.clipkit.mv.EditorSdk2MvAsset;
import h90.c;
import java.util.Comparator;
import java.util.Collections;
import com.kwai.video.minecraft.model.nano.Minecraft$WesterosFaceMagicParam;
import com.kuaishou.gifshow.kuaishan.utils.e;
import android.text.TextUtils;
import java.util.ArrayList;
import com.kwai.video.clipkit.mv.EditorSdk2MvCreationResult$TemplateType;
import com.kwai.video.clipkit.mv.AllMvReplaceableAreaDetail;
import com.kwai.video.clipkit.mv.MvReplaceableAreaDetail;
import com.kwai.video.clipkit.mv.ReplaceableAreaInfo;
import com.kwai.video.editorsdk2.model.nano.EditorSdk2$RectF;
import java.lang.Float;
import java.lang.Integer;
import android.graphics.RectF;
import com.kwai.video.clipkit.mv.MvPhotoInfo;
import java.lang.IllegalArgumentException;
import java.util.Collection;
import java.lang.Long;
import com.kwai.video.editorsdk2.model.nano.EditorSdk2$TimeRange;
import com.kuaishou.gifshow.kuaishan.model.a;
import h90.b;
import x80.g2;
import t36.f$a;
import x80.f2;
import com.yxcorp.gifshow.kuaishan.model.KSBaseInfo;
import com.yxcorp.gifshow.kuaishan.model.KSFeedTemplateDetailInfo$FrameExtraRequirement;
import lnc.g7;
import com.kwai.video.minecraft.model.nano.Minecraft$CropOptions;
import brd.t;
import com.kwai.feature.post.api.feature.memory.MemorySceneType;
import java.lang.System;
import com.kuaishou.gifshow.kuaishan.logic.i0;
import lnc.i1;
import com.kuaishou.gifshow.kuaishan.logic.i0$a;
import com.kuaishou.gifshow.kuaishan.logic.i0$b;
import java.lang.Math;
import w69.x0;
import pr3.d;
import pr3.k;
import boc.e;
import boc.b;
import com.yxcorp.gifshow.util.resource.MagicModel;
import com.yxcorp.gifshow.util.resource.MagicEmojiResourceHelper;
import java.io.File;
import brd.w;
import com.kuaishou.gifshow.kuaishan.logic.h0;
import java.util.concurrent.Callable;
import java.util.HashMap;
import java.lang.Iterable;
import com.kuaishou.gifshow.kuaishan.logic.f0;
import erd.r;
import com.kuaishou.gifshow.kuaishan.logic.p;
import erd.o;
import t45.d;
import brd.z;
import com.kuaishou.gifshow.kuaishan.logic.t;
import com.kuaishou.gifshow.kuaishan.logic.w;
import x80.m;
import erd.g;
import x80.g0;
import x80.n0;
import x80.j0;
import erd.a;
import x80.n;
import cq.a;
import java.lang.RuntimeException;
import pr3.e;
import x80.s;
import com.kuaishou.gifshow.kuaishan.logic.l;
import com.kuaishou.gifshow.kuaishan.logic.o;
import x80.q0;
import x80.v;
import x80.f0;
import x80.p0;
import com.kuaishou.gifshow.kuaishan.logic.d0;
import com.kuaishou.gifshow.kuaishan.logic.a0;
import x80.e0;
import g26.d;
import n46.b;
import com.kwai.sdk.switchconfig.a;
import com.kuaishou.gifshow.kuaishan.logic.c0;
import com.kuaishou.gifshow.kuaishan.logic.r;
import x80.h0;
import brd.a0;
import com.kuaishou.gifshow.kuaishan.logic.m;
import x80.d0;
import x80.k0;
import com.kuaishou.gifshow.kuaishan.logic.n;
import x80.i0;
import x80.o0;
import com.kuaishou.edit.draft.Workspace$Type;
import com.yxcorp.gifshow.upload.AuditFrameSwitch;
import com.kuaishou.gifshow.kuaishan.logic.q;
import com.kuaishou.gifshow.kuaishan.logic.e0;
import com.kuaishou.gifshow.kuaishan.logic.b0;
import x80.t;
import x80.u;
import x80.w;
import x80.x;
import com.kuaishou.gifshow.kuaishan.logic.g0;
import com.kuaishou.gifshow.kuaishan.logic.z;
import com.kuaishou.gifshow.kuaishan.logic.x;
import com.kuaishou.gifshow.kuaishan.logic.u;
import x80.y;
import x80.z;
import x80.a0;
import x80.l0;
import x80.j2;
import com.kuaishou.gifshow.kuaishan.logic.n1;
import x80.i2;
import x80.h2;
import java.util.regex.Pattern;
import lnc.v5;
import java.util.regex.Matcher;
import com.yxcorp.gifshow.edit.draft.model.workspace.c;
import ekd.q;
import u80.f;
import lnc.a1;
import com.kwai.video.ksspark.NewSparkTemplateManager;
import com.kwai.video.editorsdk2.PreviewEventListenerV2;
import com.yxcorp.gifshow.widget.adv.VideoSDKPlayerView;
import crd.b;
import u80.c;
import com.kwai.FaceMagic.AE2.AE2Project;
import android.util.Pair;
import vaa.a;
import com.yxcorp.gifshow.edit.draft.model.c;
import com.kuaishou.edit.draft.KuaishanAsset;
import com.yxcorp.gifshow.edit.draft.DraftUtils;
import com.kwai.feature.post.api.feature.kuaishan.model.KuaiShanAssetTag;
import com.kwai.kscnnrenderlib.YCNNModelInfo$KSFaceDetectOut;
import com.google.common.primitives.Longs$LongArrayAsList;
import ok.n;

public class o1 extends f implements d	// class@001a65
{
    public final d d;
    public final KSTemplateDetailInfo e;
    public String f;
    public b g;
    public EditorSdk2V2$VideoEditorProject h;
    public EditorSdk2Utils$PreviewSizeLimitation i;
    public EditorSdk2MvCreationResult j;
    public VideoSDKPlayerView k;
    public b l;
    public b m;
    public final List n;
    public float o;

    public void o1(KSTemplateDetailInfo p0,String p1){
       super();
       this.f = "";
       this.i = EditorSdk2Utils$PreviewSizeLimitation.PREVIEW_SIZE_LIMITATION_720P;
       this.n = new LinkedList();
       this.o = 0;
       this.e = p0;
       this.d = new d(p1);
    }
    public boolean A(){
       Iterator obj = PatchProxy.apply(null, this, o1.class, "45");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       obj = this.d.c().iterator();
       while (true) {
          if (!obj.hasNext()) {
             return false;
          }
          e h = obj.next().H;
          if (h != null && !h.isEmpty()) {
             break ;
          }
       }
       return true;
    }
    public e A0(String p0){
       e uoe;
       Iterator obj = PatchProxy.applyOneRefs(p0, this, o1.class, "11");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       if (TextUtils.x(p0)) {
          return null;
       }
       obj = this.v0().iterator();
       while (true) {
          if (!obj.hasNext()) {
             return null;
          }
          uoe = obj.next();
          if (TextUtils.n(uoe.b, p0)) {
             break ;
          }
       }
       return uoe;
    }
    public int B0(){
       int i;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       Object[] objArray = null;
       o1 obj = PatchProxy.apply(objArray, this, o1.class, "25");
       if (obj != patchProxyRe) {
          return obj.intValue();
       }
       obj = this.d;
       Objects.requireNonNull(obj);
       Object obj1 = PatchProxy.apply(objArray, obj, d.class, "7");
       if (obj1 != patchProxyRe) {
          i = obj1.intValue();
       }else {
          Iterator iterator = obj.f.keySet().iterator();
          int i1 = 0;
          while (iterator.hasNext()) {
             String str = iterator.next();
             e uoe = obj.f.get(str);
             if (uoe == null) {
                Object[] objArray1 = new Object[0];
                e.D().t("KuaiShanTemplate", "getReplacedNum: cant find "+str, objArray1);
             }else {
                i1 = i1 + uoe.a();
             }
          }
          i = i1;
       }
       return i;
    }
    public KwaiMvParam C(){
       o1 obj = PatchProxy.apply(null, this, o1.class, "6");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       obj = this.j;
       if (obj == null) {
          return null;
       }
       return obj.getMVParam();
    }
    public d C0(){
       return this.d;
    }
    public int D0(){
       return this.d.c;
    }
    public boolean E(){
       boolean b = (this.h != null)? true: false;
       return b;
    }
    public int E0(){
       return this.d.b;
    }
    public void F0(String p0){
       if (PatchProxy.applyVoidOneRefs(p0, this, o1.class, "13")) {
          return;
       }
       try{
          this.f = ClipMvUtils.getActivityIdWithTemplate(p0);
       }catch(java.io.IOException e3){
          this.f = "";
          e.D().e("KuaiShanProject", "initActivityId templatePath: "+p0+" IOException: ", e3);
       }catch(com.kwai.video.clipkit.error.EditorSdk2MvCreationException e3){
          this.f = "";
          e.D().e("KuaiShanProject", "initActivityId templatePath: "+p0+" EditorSdk2MvCreateException: ", e3);
       }catch(java.lang.Exception e3){
          this.f = "";
          PostUtils.D("KuaiShanProject", "initActivityId templatePath: "+p0, e3);
       }
       Object[] objArray = new Object[0];
       e.D().w("KuaiShanProject", "initActivityId: "+this.f, objArray);
       return;
    }
    public void G(String p0,QMedia p1,String p2,boolean p3){
       if (PatchProxy.isSupport(o1.class) && PatchProxy.applyVoidFourRefs(p0, p1, p2, Boolean.valueOf(p3), this, o1.class, "47")) {
          return;
       }
       e uoe = this.A0(p2);
       if (uoe == null) {
          return;
       }
       uoe.p(p0, p1, 0, p3);
       return;
    }
    public void G0(EditorSdk2MvCreationResult p0){
       Object[] objArray1;
       EditorSdk2V2$VideoEditorProject project;
       o1 d;
       o1 e;
       Object[] objArray3;
       e uoe1;
       Iterator obj1;
       String str3;
       e uoe2;
       b uob;
       Object[] objArray5;
       e uoe5;
       e uoe6;
       String obj3;
       boolean b;
       Iterator iterator4;
       Integer integer2;
       PatchProxyResult patchProxyRe1;
       Object[] objArray6;
       Object[] objArray7;
       Iterator iterator6;
       Object[] objArray8;
       String str5;
       o1 oo11;
       Object obj4;
       int i2;
       MvReplaceableAreaDetail info;
       e uoe7;
       Object[] objArray10;
       RectF rectF;
       Iterator iterator10;
       boolean b2;
       e uoe9;
       EditorSdk2MvCreationResult uEditorSdk2M = this;
       o1 obj = p0;
       String str = "14";
       if (PatchProxy.applyVoidOneRefs(obj, uEditorSdk2M, o1.class, str)) {
          return;
       }
       boolean i = 0;
       Object[] objArray = new Object[i];
       String str1 = "KuaiShanProject";
       e.D().s(str1, "initKuaiShanProject\(\) called ", objArray);
       if (uEditorSdk2M.h != null) {
          objArray1 = new Object[i];
          e.D().A(str1, "initKuaiShanProject has been initialized", objArray1);
          return;
       }else if(obj == null || p0.getProject() == null){
          obj = uEditorSdk2M;
          objArray1 = new Object[0];
          e.D().t(str1, "initKuaiShanProject: initialize failed project is null", objArray1);
          obj.s0(new f2(obj));
          return;
       }else {
          uEditorSdk2M.j = obj;
          project = p0.getProject();
          uEditorSdk2M.h = project;
          project.setMarginColor(d.h(0x121212));
          uEditorSdk2M.h.setProjectOutputWidth(EditorSdk2UtilsV2.getLimitedWidth(p0.getVideoWidth(), p0.getVideoHeight(), uEditorSdk2M.i));
          uEditorSdk2M.h.setProjectOutputHeight(EditorSdk2UtilsV2.getLimitedHeight(p0.getVideoWidth(), p0.getVideoHeight(), uEditorSdk2M.i));
          d = uEditorSdk2M.d;
          e = uEditorSdk2M.e;
          Objects.requireNonNull(d);
          e uoe = e.class;
          PatchProxyResult patchProxyRe = PatchProxyResult.class;
          if (!PatchProxy.applyVoidTwoRefs(obj, e, d, d.class, "11")) {
             Object[] objArray2 = new Object[i];
             e.D().w("KuaiShanTemplate", "initReplaceableArea: ", objArray2);
             d.b = p0.getVideoWidth();
             d.c = p0.getVideoHeight();
             if (!d.e.isEmpty() || !d.f.isEmpty()) {
                objArray2 = new Object[i];
                e.D().A("KuaiShanTemplate", "initReplaceableArea: twice call", objArray2);
             }
             d.e.clear();
             d.f.clear();
             LinkedHashMap linkedHashMa = PatchProxy.applyTwoRefs(obj, e, d, d.class, "13");
             String str2 = "ReplaceableArea";
             if (linkedHashMa != patchProxyRe) {
             }else {
                objArray3 = new Object[i];
                e.D().w("KuaiShanTemplate", "buildAreasAndGroups: ", objArray3);
                d.f.clear();
                linkedHashMa = new LinkedHashMap();
                List replaceableM = p0.getReplaceableMvAssets();
                objArray7 = new Object[i];
                e.D().w("KuaiShanTemplate", "buildAreasAndGroups: sdk return area num="+replaceableM.size(), objArray7);
                if (!PatchProxy.applyVoidOneRefs(replaceableM, d, d.class, "30")) {
                   objArray8 = new Object[i];
                   e.D().s("KuaiShanTemplate", "sort ReplaceableArea using visibleTime startTime", objArray8);
                   iterator10 = replaceableM.iterator();
                   while (true) {
                      if (iterator10.hasNext()) {
                         if (iterator10.next().getGroupId() == null) {
                            objArray8 = new Object[i];
                            e.D().s("KuaiShanTemplate", "No groupId, do not need sort ReplaceableArea ", objArray8);
                         }
                      }else {
                         Collections.sort(replaceableM, new c(d));
                      }
                   }
                }
                iterator10 = replaceableM.iterator();
                while (iterator10.hasNext()) {
                   EditorSdk2MvAsset uEditorSdk2M1 = iterator10.next();
                   Minecraft$WesterosFaceMagicParam obj5 = PatchProxy.applyOneRefs(uEditorSdk2M1, d, d.class, "12");
                   if (obj5 != patchProxyRe) {
                      b2 = obj5.booleanValue();
                   }else {
                      obj5 = uEditorSdk2M1.getFaceMagicParam();
                      String str6 = (TextUtils.x(uEditorSdk2M1.getServiceType()) && (!uEditorSdk2M1.requireClipBody() && (uEditorSdk2M1.requireClipFace() || uEditorSdk2M1.requireClipHead())))? 1: null;
                      if (obj5 == null && !str6) {
                         b2 = true;
                      }else {
                         b2 = false;
                      }
                   }
                   if (b2) {
                      uoe9 = d.a(obj, uEditorSdk2M1, e);
                      if (linkedHashMa.containsKey(uoe9.d)) {
                         continue ;
                      }
                   }else {
                      continue ;
                   }
                   d.f.put(uoe9.b, uoe9);
                   linkedHashMa.put(uoe9.d, uoe9);
                   iterator6 = null;
                }
                iterator6 = replaceableM.iterator();
                while (iterator6.hasNext()) {
                   EditorSdk2MvAsset uEditorSdk2M2 = iterator6.next();
                   if (d.f.containsKey(uEditorSdk2M2.getRefId())) {
                   }else {
                      e uoe10 = d.a(obj, uEditorSdk2M2, e);
                      d.f.put(uoe10.b, uoe10);
                      String str7 = (e.t(e))? d.h(e, uEditorSdk2M2.getRefId()): uEditorSdk2M2.getGroupId();
                      e uoe11 = linkedHashMa.get(str7);
                      Iterator iterator11 = iterator6;
                      o1 oo12 = e;
                      objArray = new Object[0];
                      e.D().w("KuaiShanTemplate", "buildAreasAndGroups: sdk return area "+uoe10, objArray);
                      if (uoe11 != null) {
                         if (!PatchProxy.applyVoidOneRefs(uoe10, uoe11, uoe, "8")) {
                            if (!TextUtils.equals(uoe10.d, uoe11.d)) {
                               objArray3 = new Object[0];
                               e.D().t(str2, "addSubReplaceableArea: wrong arg mGroupId="+uoe11.d+" area="+uoe10, objArray3);
                            }else {
                               uoe5 = uoe11.A;
                               if (uoe5 == null) {
                                  uoe11.A = new ArrayList();
                               }else {
                                  iterator6 = uoe5.iterator();
                                  do {
                                     if (iterator6.hasNext()) {
                                        if (!TextUtils.equals(iterator6.next().b, uoe10.b)) {
                                           continue ;
                                        }
                                     }
                                  } while (TextUtils.equals(iterator6.next().b, uoe10.b));
                               }
                               uoe10.G = true;
                               uoe11.A.add(uoe10);
                               objArray3 = new Object[0];
                               e.D().s(str2, "addSubReplaceableArea: this="+uoe11.b+" sub="+uoe10.b, objArray3);
                            }
                         }
                      }else {
                         linkedHashMa.put(uoe10.d, uoe10);
                      }
                      iterator6 = iterator11;
                      e = oo12;
                   }
                }
             }
             int i1 = 0;
             objArray3 = new Object[i1];
             e.D().w("KuaiShanTemplate", "initReplaceableArea: groups "+linkedHashMa, objArray3);
             if (!PatchProxy.applyVoidOneRefs(obj, d, d.class, "16")) {
                objArray3 = new Object[i1];
                e.D().w("KuaiShanTemplate", "initAreasRectAndTimestamp: ", objArray3);
                i = (p0.getTemplateType() == EditorSdk2MvCreationResult$TemplateType.TEMPLATE_TYPE_NEW_SPARK)? true: false;
                AllMvReplaceableAreaDetail details = (i)? p0.getSparkAllDetail().details: p0.getMVParam().allDetails.details;
                objArray7 = new Object[0];
                e.D().w("KuaiShanTemplate", "initAreasRectAndTimestamp: isShimmer="+i, objArray7);
                if (details != null) {
                   iterator6 = details.iterator();
                   o1 oo1 = d;
                   while (true) {
                      if (iterator6.hasNext()) {
                         MvReplaceableAreaDetail mvReplaceabl = iterator6.next();
                         if (mvReplaceabl.info == null) {
                            objArray7 = new Object[0];
                            e.D().t("KuaiShanTemplate", "initAreasRectAndTimestamp: no info detail="+mvReplaceabl, objArray7);
                         }else {
                            MvReplaceableAreaDetail replaceableA = mvReplaceabl.replaceableAreaDetail;
                            if (replaceableA == null) {
                               objArray7 = new Object[0];
                               e.D().t("KuaiShanTemplate", "initAreasRectAndTimestamp: no replaceableAreaDetail detail="+mvReplaceabl, objArray7);
                               continue ;
                            }else {
                               Iterator iterator7 = replaceableA.iterator();
                               while (true) {
                                  if (iterator7.hasNext()) {
                                     ReplaceableAreaInfo replaceableA1 = iterator7.next();
                                     ReplaceableAreaInfo refId = replaceableA1.refId;
                                     if (refId == null) {
                                        objArray8 = new Object[0];
                                        e.D().t("KuaiShanTemplate", "initAreasRectAndTimestamp: wrong data "+replaceableA1, objArray8);
                                        iterator6 = iterator6;
                                        iterator7 = iterator7;
                                     }else {
                                        Iterator iterator8 = iterator6;
                                        Iterator iterator9 = iterator7;
                                        ReplaceableAreaInfo rect = replaceableA1.rect;
                                        String str4 = "]";
                                        if (PatchProxy.applyVoidTwoRefs(refId, rect, oo1, d.class, "18")) {
                                           uoe1 = uoe;
                                           str3 = str2;
                                        }else {
                                           str3 = str2;
                                           uoe1 = uoe;
                                           Object[] objArray9 = new Object[0];
                                           e.D().s("KuaiShanTemplate", "setAreaRect\(\) called with: refId = ["+refId+"], sdk rect = ["+rect+str4, objArray9);
                                           if (rect != null) {
                                              uoe2 = oo1.f.get(refId);
                                              if (uoe2 == null) {
                                                 objArray6 = new Object[0];
                                                 e.D().t("KuaiShanTemplate", "setAreaRect: cant find ReplaceableArea refId="+refId, objArray6);
                                              }else {
                                                 float f = rect.left();
                                                 float f1 = rect.top();
                                                 float f2 = rect.right();
                                                 float f3 = rect.bottom();
                                                 d b1 = oo1.b;
                                                 d c = oo1.c;
                                                 obj4 = linkedHashMa;
                                                 e uoe8 = e.class;
                                                 if (PatchProxy.isSupport(uoe8)) {
                                                    str5 = str4;
                                                    Object[] objArray11 = new Object[]{Float.valueOf(f),Float.valueOf(f1),Float.valueOf(f2),Float.valueOf(f3),Integer.valueOf(b1),Integer.valueOf(c)};
                                                    oo11 = d;
                                                    rectF = PatchProxy.apply(objArray11, null, uoe8, str);
                                                    if (rectF != patchProxyRe) {
                                                    label_048b :
                                                       i2 = 0;
                                                       objArray6 = new Object[i2];
                                                       e.D().w("KuaiShanTemplate", "setAreaRect: ui rect"+rectF, objArray6);
                                                       uoe2.a.set(rectF);
                                                    label_04ab :
                                                       info = mvReplaceabl.info;
                                                       if (info == null) {
                                                          objArray9 = new Object[i2];
                                                          e.D().t("KuaiShanTemplate", "initAreasRectAndTimestamp: no detail.info", objArray9);
                                                          e = oo11;
                                                       }else {
                                                          ReplaceableAreaInfo refId1 = replaceableA1.refId;
                                                          MvPhotoInfo time = info.time;
                                                          if (PatchProxy.isSupport(d.class)) {
                                                             e = oo11;
                                                             if (!PatchProxy.applyVoidTwoRefs(refId1, Integer.valueOf(time), e, d.class, "19")) {
                                                             }
                                                          }else {
                                                             e = oo11;
                                                          }
                                                       }
                                                    label_0529 :
                                                       d = e;
                                                       oo1 = d;
                                                       iterator6 = iterator8;
                                                       iterator7 = iterator9;
                                                       str2 = str3;
                                                       uoe = uoe1;
                                                       linkedHashMa = obj4;
                                                       continue ;
                                                    }
                                                 }else {
                                                    str5 = str4;
                                                    oo11 = d;
                                                 }
                                                 if (b1 > null && c > null) {
                                                    float f4 = (float)b1;
                                                    f = f / f4;
                                                    float f5 = (float)c;
                                                    f1 = f1 / f5;
                                                    f2 = f2 / f4;
                                                    f3 = f3 / f5;
                                                    rectF = new RectF(f, f1, f2, f3);
                                                    goto label_048b ;
                                                 }else {
                                                    objArray1 = new Object[0];
                                                    e.D().t("KSUtil", "toRelativeCoordinate: wrong arg videoW="+b1+" videoH="+c, objArray1);
                                                    throw new IllegalArgumentException(" w="+b1+" h="+c);
                                                 }
                                              }
                                           }
                                        }
                                        str5 = str4;
                                        oo11 = d;
                                        obj4 = linkedHashMa;
                                        i2 = 0;
                                        goto label_04ab ;
                                     }
                                  }else {
                                     int i3 = p0;
                                     continue ;
                                  }
                               }
                            }
                         }
                      }else {
                         uoe1 = uoe;
                         obj4 = linkedHashMa;
                         str3 = str2;
                         d = oo1;
                      label_058e :
                         Object[] obj2 = obj1;
                         LinkedList linkedList = PatchProxy.applyTwoRefs(p0, obj2, null, d.class, "15");
                         if (linkedList != patchProxyRe) {
                         }else {
                            ArrayList uArrayList = new ArrayList(p0.getThumbnailRenderPosMillis());
                            LinkedList linkedList1 = new LinkedList();
                            Iterator iterator2 = obj2.values().iterator();
                            while (iterator2.hasNext()) {
                               uoe5 = iterator2.next();
                               if (!uoe5.F - -1) {
                                  Integer integer = Integer.valueOf(-1);
                                  Iterator iterator3 = uArrayList.iterator();
                                  while (true) {
                                     if (iterator3.hasNext()) {
                                        Integer integer1 = iterator3.next();
                                        long l = (long)integer1.intValue();
                                        if (PatchProxy.isSupport(uoe1)) {
                                           uoe6 = uoe1;
                                           obj3 = PatchProxy.applyOneRefs(Long.valueOf(l), uoe5, uoe6, "10");
                                           if (obj3 != patchProxyRe) {
                                              b = obj3.booleanValue();
                                              iterator4 = iterator2;
                                              integer2 = integer;
                                              obj1 = iterator3;
                                              patchProxyRe1 = patchProxyRe;
                                           }else {
                                           label_0609 :
                                              Iterator iterator5 = uoe5.y.iterator();
                                              while (true) {
                                                 if (iterator5.hasNext()) {
                                                    EditorSdk2$TimeRange timeRange = iterator5.next();
                                                    iterator4 = iterator2;
                                                    integer2 = integer;
                                                    obj1 = iterator3;
                                                    patchProxyRe1 = patchProxyRe;
                                                    objArray5 = new Object[0];
                                                    e.D().s(str3, "isVisibleTimeContains: start="+timeRange.start()+" duration="+timeRange.duration(), objArray5);
                                                    double d1 = (double)l;
                                                    double d2 = timeRange.start() * 0x408f400000000000;
                                                    if (d1 - d2 >= 0) {
                                                       d2 = timeRange.start() + timeRange.duration();
                                                       d2 = d2 * 0x408f400000000000;
                                                       if (d1 - d2 <= 0) {
                                                          b = true;
                                                       }
                                                    }
                                                    iterator2 = iterator4;
                                                    integer = integer2;
                                                    iterator3 = obj1;
                                                    patchProxyRe = patchProxyRe1;
                                                 }else {
                                                    iterator4 = iterator2;
                                                    integer2 = integer;
                                                    obj1 = iterator3;
                                                    patchProxyRe1 = patchProxyRe;
                                                    b = false;
                                                 }
                                              }
                                           }
                                        }else {
                                           uoe6 = uoe1;
                                           goto label_0609 ;
                                        }
                                        if (b) {
                                           uoe5.F = (long)integer1.intValue();
                                           integer = integer1;
                                        label_06a5 :
                                           uArrayList.remove(integer);
                                        }else {
                                           iterator2 = iterator4;
                                           integer = integer2;
                                           iterator3 = obj1;
                                           patchProxyRe = patchProxyRe1;
                                           uoe1 = uoe6;
                                           obj3 = -1;
                                        }
                                     }else {
                                        iterator4 = iterator2;
                                        patchProxyRe1 = patchProxyRe;
                                        uoe6 = uoe1;
                                        integer2 = integer;
                                        goto label_06a5 ;
                                     }
                                  }
                               }else {
                                  iterator4 = iterator2;
                                  patchProxyRe1 = patchProxyRe;
                                  uoe6 = uoe1;
                               }
                               if (!uoe5.F - -1) {
                                  objArray6 = new Object[0];
                                  e.D().t("KuaiShanTemplate", "getOrderGroup: cant find keyframe for group="+uoe5, objArray6);
                               }else {
                                  linkedList1.add(uoe5);
                               }
                               iterator2 = iterator4;
                               uoe1 = uoe6;
                               patchProxyRe = patchProxyRe1;
                            }
                            Collections.sort(linkedList1, a.b);
                            linkedList = linkedList1;
                         }
                         Iterator iterator = linkedList.iterator();
                         while (iterator.hasNext()) {
                            uoe2 = iterator.next();
                            uob = new b(d.e.size(), uoe2.F);
                            if (PatchProxy.applyVoidOneRefs(uoe2, uob, b.class, "9")) {
                               e uoe3 = 1;
                            }else {
                               uob.c.add(uoe2);
                               if (uob.c.size() > 1) {
                                  obj2 = new Object[0];
                                  e.D().t("KuaiShanKeyFrame", "setGroup: there are too many group in KeyFrame="+uob.a+" areas="+uob.c, obj2);
                               }
                            }
                            uoe2.r(uob);
                            if (PatchProxy.applyVoidOneRefs(uob, d, d.class, "2")) {
                               continue ;
                            }
                            d.e.add(uob);
                         }
                         if (!PatchProxy.applyVoid(null, d, d.class, "17")) {
                            Object[] objArray4 = new Object[0];
                            e.D().w("KuaiShanTemplate", "removeUseless: ", objArray4);
                            linkedList = new LinkedList();
                            Iterator iterator1 = d.e.iterator();
                            while (iterator1.hasNext()) {
                               uob = iterator1.next();
                               if (uob.c.isEmpty()) {
                                  objArray5 = new Object[0];
                                  e.D().t("KuaiShanTemplate", "removeUseless: keyFrame is useless "+uob, objArray5);
                                  linkedList.add(uob);
                               }else {
                                  continue ;
                               }
                            }
                            d.e.removeAll(linkedList);
                            linkedList = new LinkedList();
                            iterator1 = d.f.values().iterator();
                            while (iterator1.hasNext()) {
                               e uoe4 = iterator1.next();
                               if (uoe4.l.isEmpty()) {
                                  objArray5 = new Object[0];
                                  e.D().t("KuaiShanTemplate", "removeUseless: ReplaceableArea is useless "+uoe4, objArray5);
                                  linkedList.add(uoe4);
                               }else {
                                  continue ;
                               }
                            }
                            iterator = linkedList.iterator();
                            while (iterator.hasNext()) {
                               d.f.remove(iterator.next().b);
                            }
                         }
                         objArray1 = new Object[0];
                         e.D().w("KuaiShanTemplate", "initReplaceableArea: init over "+d.e, objArray1);
                      }
                   }
                }
             }
             e = d;
             uoe1 = uoe;
             obj1 = linkedHashMa;
             str3 = str2;
             d = e;
             goto label_058e ;
          }
          obj = this;
          obj.s0(new g2(obj));
          return;
       }
    }
    public boolean H(){
       Iterator obj = PatchProxy.apply(null, this, o1.class, "2");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       obj = this.d.c().iterator();
       while (true) {
          if (!obj.hasNext()) {
             return false;
          }
          if (obj.next().B != null) {
             break ;
          }
       }
       return true;
    }
    public boolean H0(){
       boolean b = (this.h != null)? true: false;
       return b;
    }
    public int I(){
       return this.d.b;
    }
    public boolean J0(){
       Object obj = PatchProxy.apply(null, this, o1.class, "36");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       return this.e.isShimmer();
    }
    public boolean K0(){
       return this.e.mIsSupportVideo;
    }
    public boolean L0(){
       KSBaseInfo obj = PatchProxy.apply(null, this, o1.class, "39");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       obj = this.e.mFrameExtraRequirementList;
       if (obj == null) {
          return this.d.i();
       }
       Iterator iterator = obj.iterator();
       while (true) {
          if (!iterator.hasNext()) {
             return this.d.i();
          }
          if (iterator.next().mRequireFace != null) {
             break ;
          }
       }
       return true;
    }
    public final void M0(){
       if (PatchProxy.applyVoid(null, this, o1.class, "48")) {
          return;
       }
       g7.q();
       return;
    }
    public Minecraft$CropOptions N(String p0){
       Object obj = PatchProxy.applyOneRefs(p0, this, o1.class, "17");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       if (TextUtils.x(p0)) {
          return null;
       }
       e uoe = this.d.g(p0);
       if (uoe == null) {
          return null;
       }
       return uoe.e;
    }
    public void N0(EditorSdk2Utils$PreviewSizeLimitation p0){
       this.i = p0;
    }
    public t O0(List p0,String p1,boolean p2){
       if (PatchProxy.isSupport(o1.class)) {
          Object obj = PatchProxy.applyThreeRefs(p0, p1, Boolean.valueOf(p2), this, o1.class, "41");
          if (obj != PatchProxyResult.class) {
             return obj;
          }
       }
       return this.P0(p0, p1, false, false, true, null, p2);
    }
    public t P0(List p0,String p1,boolean p2,boolean p3,boolean p4,MemorySceneType p5,boolean p6){
       List obj1;
       o1 e;
       t ot;
       KSTemplateDetailInfo kSTemplateDe;
       LinkedList linkedList;
       e uoe1;
       KSTemplateDetailInfo kSTemplateDe1;
       Object obj4;
       Object obj5;
       i0 oi01;
       i0$a uoa1;
       String str2;
       KSTemplateDetailInfo kSTemplateDe2;
       KSTemplateDetailInfo kSTemplateDe3;
       String str3;
       t ot2;
       long l1;
       int i8;
       t ot3;
       t ot4;
       AuditFrameSwitch mAiCutEnable;
       t ot5;
       HashMap obj7;
       long l5;
       k a;
       ArrayList obj8;
       boolean b;
       Iterator iterator3;
       e uoe3;
       e obj9;
       i0$b uob1;
       e obj = this;
       object oobject = p0;
       object oobject1 = p1;
       object oobject2 = p5;
       e uoe = e.class;
       o1 oo1 = o1.class;
       int i = 7;
       int i1 = 6;
       boolean i2 = 5;
       int i3 = 4;
       boolean i4 = 1;
       boolean i5 = 0;
       if (PatchProxy.isSupport(oo1)) {
          Object[] objArray = new Object[i];
          objArray[i5] = oobject;
          objArray[i4] = oobject1;
          objArray[2] = Boolean.valueOf(p2);
          objArray[3] = Boolean.valueOf(p3);
          objArray[i3] = Boolean.valueOf(p4);
          objArray[i2] = oobject2;
          objArray[i1] = Boolean.valueOf(p6);
          obj1 = PatchProxy.apply(objArray, obj, oo1, "42");
          if (obj1 != PatchProxyResult.class) {
             return obj1;
          }
       }
       String str = " medias size=";
       Object[] objArray1 = new Object[i5];
       e.D().w("KuaiShanProject", "setupMedias: refId="+oobject1+str+p0.size(), objArray1);
       obj1 = obj.d.e(oobject1);
       List list = PatchProxy.applyOneRefs(obj1, null, uoe, "68");
       if (list != PatchProxyResult.class) {
       }else {
          ArrayList uArrayList2 = new ArrayList();
          iterator3 = obj1.iterator();
          while (iterator3.hasNext()) {
             Object obj10 = iterator3.next();
             String str5 = obj10.b();
             if (str5 != null) {
                if (str5.contains("ms_album")) {
                   uArrayList2.add(obj10);
                }
                String str6 = 5;
             }else {
                str5 = 6;
             }
          }
          if (!uArrayList2.isEmpty()) {
             ArrayList uArrayList3 = uArrayList2;
          }
          list = obj1;
       }
       long l = System.currentTimeMillis();
       String id = obj.e.getId();
       e = obj.e;
       KSTemplateDetailInfo mDisableClie = e.mDisableClientCache;
       boolean templateGrad = e.getTemplateGrade();
       KSTemplateDetailInfo mTypeFrom = obj.e.mTypeFrom;
       i0 oi0 = i0.class;
       if (PatchProxy.isSupport(oi0)) {
          Object[] objArray2 = new Object[10];
          objArray2[i5] = oobject;
          objArray2[i4] = list;
          objArray2[2] = id;
          objArray2[3] = Boolean.valueOf(mDisableClie);
          objArray2[4] = Boolean.valueOf(p2);
          objArray2[5] = Boolean.valueOf(p3);
          objArray2[6] = Boolean.valueOf(p4);
          objArray2[7] = oobject2;
          objArray2[8] = Integer.valueOf(templateGrad);
          objArray2[9] = mTypeFrom;
          ot = PatchProxy.apply(objArray2, null, oi0, "2");
          if (ot != PatchProxyResult.class) {
             int i6 = p4;
          label_0762 :
             j2 oj2 = new j2(this, l, p4, p6, p1, p0);
             oo1 = this;
             return ot.observeOn(d.a).doOnNext(oi0).map(n1.b).doOnError(new i2(oo1)).doOnComplete(new h2(oo1));
          }
       }
       String str1 = "KSPrepareMediaAPI";
       if (list.size() != p0.size()) {
          i1.a(str1, "prepareMedias groups.size="+list.size()+str+p0.size());
       }
       i0$a uoa = new i0$a();
       if (PatchProxy.isSupport(oi0)) {
          Object[] objArray3 = new Object[]{oobject,list,Boolean.valueOf(p3),id,Integer.valueOf(templateGrad)};
          kSTemplateDe = mTypeFrom;
          linkedList = PatchProxy.apply(objArray3, null, oi0, "1");
          if (linkedList != PatchProxyResult.class) {
          }
       }else {
          kSTemplateDe = mTypeFrom;
          int i12 = 4;
       }
       if (list.size() != p0.size()) {
          i1.a(str1, "assemblePrepareTask groups.size="+list.size()+str+p0.size());
       }
       linkedList = new LinkedList();
       if (p3) {
          obj8 = new ArrayList();
          iterator3 = list.iterator();
          while (iterator3.hasNext()) {
             uoe3 = iterator3.next();
             obj8.add(uoe3);
             obj8.addAll(uoe3.k());
          }
          int i10 = 0;
          while (i10 < obj8.size()) {
             uoe3 = obj8.get(i10);
             obj9 = oobject.get(i10);
             uoe3.w = (double)obj9.mExportPositionX;
             uoe3.x = (double)obj9.mExportPositionY;
             uob1 = new i0$b(linkedList.size(), obj9, uoe3, id, templateGrad);
             linkedList.add(oobject2);
             i10 = i10 + 1;
             obj8 = obj8;
             mDisableClie = mDisableClie;
             uoe = uoe;
          }
          uoe1 = uoe;
          kSTemplateDe1 = mDisableClie;
       }else {
          uoe1 = uoe;
          kSTemplateDe1 = mDisableClie;
          int i11 = Math.min(p0.size(), list.size());
          int i7 = 0;
          while (i7 < i11) {
             obj9 = list.get(i7);
             QMedia qMedia = oobject.get(i7);
             uob1 = new i0$b(linkedList.size(), qMedia, obj9, id, templateGrad);
             linkedList.add(i5);
             Iterator iterator4 = obj9.k().iterator();
             while (iterator4.hasNext()) {
                uob1 = new i0$b(linkedList.size(), x0.a(qMedia), iterator4.next(), id, templateGrad);
                linkedList.add(i5);
             }
             i7 = i7 + 1;
          }
          uoa.c = linkedList;
          e.w("Start prepare medias, tasks.size="+linkedList.size()+" media.size="+p0.size()+" group.size="+list.size());
          Object[] obj2 = null;
          t ot1 = PatchProxy.applyOneRefs(linkedList, obj2, oi0, "12");
          if (ot1 != PatchProxyResult.class) {
             i5 = false;
          }else {
             a = k.a;
             MagicModel c = e.c;
             i2 = true;
             t ot6 = a.a(c, false, false, i2);
             ot1 = a.a(e.l, false, false, i2);
             obj8 = PatchProxy.applyOneRefs(linkedList, obj2, oi0, "13");
             String str4 = "downloadModel\(\) has model, skip download";
             if (obj8 != PatchProxyResult.class) {
                templateGrad = obj8.booleanValue();
             }else if(new File(MagicEmojiResourceHelper.h(c.mResource)).exists()){
                Object[] objArray5 = new Object[0];
                e.D().w(str1, str4, objArray5);
             }else {
                Iterator iterator2 = linkedList.iterator();
                while (true) {
                   if (iterator2.hasNext()) {
                      if (iterator2.next().c()) {
                         templateGrad = true;
                         break ;
                      }
                   }
                }
             }
             templateGrad = false;
             obj8 = PatchProxy.apply(null, null, oi0, "14");
             if (obj8 != PatchProxyResult.class) {
                b = obj8.booleanValue();
                i5 = false;
             }else if(new File(MagicEmojiResourceHelper.h(e.l.mResource)).exists()){
                Object[] objArray4 = new Object[0];
                e.D().w(str1, str4, objArray4);
                b = false;
             }else {
                b = true;
             }
             if (b && templateGrad) {
                ot1 = ot6.concatWith(ot1);
             }else if(templateGrad){
                ot1 = ot6;
             }else if(b){
                ot1 = t.fromCallable(h0.b);
             }
          }
          t obj3 = p5;
          obj2 = PatchProxy.applyTwoRefs(linkedList, obj3, null, oi0, "10");
          if (obj2 != PatchProxyResult.class) {
             obj4 = ot1;
             obj5 = linkedList;
             oi01 = oi0;
             uoa1 = uoa;
             str2 = str1;
             kSTemplateDe2 = kSTemplateDe;
             kSTemplateDe3 = kSTemplateDe1;
             str3 = id;
             ot2 = obj2;
             i7 = 5;
          }else {
             d uod1 = new d();
             uod1.c = new HashMap();
             HashMap hashMap1 = new HashMap();
             HashMap hashMap2 = new HashMap();
             long l6 = System.currentTimeMillis();
             obj4 = ot1;
             oi01 = oi0;
             j0 oj0 = mTypeFrom;
             kSTemplateDe2 = kSTemplateDe;
             str3 = id;
             j0 oj01 = mTypeFrom;
             obj5 = linkedList;
             obj7 = hashMap1;
             uoa1 = uoa;
             HashMap hashMap3 = hashMap2;
             str2 = str1;
             kSTemplateDe3 = kSTemplateDe1;
             i7 = 5;
             oj0 = new j0(uod1, linkedList, obj7, hashMap3, l6, p5);
             ot2 = t.fromIterable(linkedList).filter(f0.b).distinct(p.b).observeOn(d.c).flatMap(t.b).flatMap(w.b).observeOn(d.a).doOnNext(new m(uod1, hashMap1, hashMap2)).map(new g0(linkedList, uod1)).switchIfEmpty(t.fromCallable(new n0(uod1))).doOnComplete(oj01).doOnError(new n(obj3, l6));
          }
          String obj6 = PatchProxy.applyOneRefs(list, null, oi01, "3");
          if (obj6 != PatchProxyResult.class) {
             l1 = obj6.longValue();
          }else {
             obj6 = null;
             Iterator iterator = list.iterator();
             while (iterator.hasNext()) {
                obj = iterator.next();
                long l4 = obj.h();
                if (l4 - obj6 > 0) {
                   l5 = l4;
                }
                Iterator iterator1 = obj.k().iterator();
                while (iterator1.hasNext()) {
                   l4 = iterator1.next().h();
                   if (l4 - l5 > 0) {
                      l5 = l4;
                   }
                }
             }
             l1 = obj6;
          }
          if (PatchProxy.isSupport(oi01)) {
             obj2 = new Object[i7];
             i8 = 0;
             obj2[i8] = obj5;
             obj2[1] = Boolean.valueOf(p2);
             obj2[2] = Boolean.valueOf(p4);
             obj2[3] = obj3;
             obj2[4] = Long.valueOf(l1);
             ot3 = PatchProxy.apply(obj2, null, oi01, "9");
             if (ot3 != PatchProxyResult.class) {
             label_0492 :
                obj = obj5;
             label_0514 :
                obj3 = PatchProxy.applyOneRefs(obj, null, oi01, "8");
                if (obj3 != PatchProxyResult.class) {
                }else {
                   obj3 = t.fromIterable(obj).filter(d0.b).flatMap(a0.b).map(new e0(obj, new d()));
                }
                if (PatchProxy.isSupport(oi01)) {
                   ot4 = PatchProxy.applyThreeRefs(str3, Boolean.valueOf(kSTemplateDe3), obj, null, i0.class, "5");
                   if (ot4 != PatchProxyResult.class) {
                   }else {
                   label_055c :
                      d uod = new d();
                      uod.c = new HashMap();
                      HashMap hashMap = new HashMap();
                      ArrayList uArrayList = new ArrayList();
                      long l2 = 0x5265c00;
                      b uob = (d.c(str3) || e.r(obj))? new b(i8, l2): new b((kSTemplateDe3 ^ 0x01), l2);
                      ArrayList uArrayList1 = new ArrayList();
                      LinkedList linkedList1 = new LinkedList();
                      obj7 = PatchProxy.applyOneRefs(obj, null, uoe1, "66");
                      if (obj7 != PatchProxyResult.class) {
                         i4 = obj7.booleanValue();
                      }else if(a.t().d("enableKuaishanNewServerProcess", i8) && e.r(obj)){
                         i4 = true;
                      }else {
                         i4 = false;
                      }
                      if (i4) {
                         ot4 = t.fromIterable(obj).filter(c0.b).distinct(r.b).flatMap(new h0(obj, uArrayList)).toList().w(new m(str3, uArrayList, uob, uod)).observeOn(d.a).map(new d0(uod)).doOnComplete(new k0(obj, uod));
                      }else {
                         n on = new n(linkedList1, uArrayList1, str3, uob, uod);
                         ot4 = t.fromIterable(obj).filter(c0.b).distinct(r.b).observeOn(d.c).flatMap(obj7).observeOn(d.a).map(new i0(hashMap, uod)).doOnComplete(new o0(obj, uod));
                      }
                   }
                }else {
                   goto label_055c ;
                }
                KSTemplateDetailInfo kSTemplateDe4 = kSTemplateDe2;
                if (kSTemplateDe4 != Workspace$Type.AI_CUT && (kSTemplateDe4 == Workspace$Type.VIDEO || kSTemplateDe4 == Workspace$Type.LONG_VIDEO)) {
                   mAiCutEnable = AuditFrameSwitch.getSwitch().mAiCutEnabled;
                }else if(kSTemplateDe4 == Workspace$Type.ALBUM_MOVIE){
                   mAiCutEnable = AuditFrameSwitch.getSwitch().mAlbumMovieEnabled;
                }else if(kSTemplateDe4 == Workspace$Type.PHOTO_MOVIE){
                   mAiCutEnable = AuditFrameSwitch.getSwitch().mPhotoMovieEnabled;
                }else {
                   mAiCutEnable = AuditFrameSwitch.getSwitch().mKuaiShanEnabled;
                }
                int i9 = a.t().d("disableIllegalInfoDetect", i8) ^ 1;
                if (mAiCutEnable != null || i9) {
                   ot5 = PatchProxy.applyOneRefs(obj, null, oi01, "4");
                   if (ot5 != PatchProxyResult.class) {
                   }else {
                      ot5 = t.fromIterable(obj).distinct(q.b).filter(e0.b).toList().d0().flatMap(b0.b);
                   }
                }else {
                   e uoe2 = new e(i8);
                   uoe2.d(100);
                   ot5 = t.just(uoe2);
                }
                i0$a uoa2 = uoa1;
                ot3 = t.concat(obj4.map(new t(uoa2)), ot2.map(new u(uoa2)), ot3.map(new w(uoa2)));
                if (!p3) {
                   ot3 = ot3.concatWith(ot5.map(new x(uoa2)));
                }
                ot1 = PatchProxy.applyOneRefs(obj, null, oi01, "17");
                if (ot1 != PatchProxyResult.class) {
                }else {
                   ot1 = t.fromIterable(obj).filter(g0.b).distinct(z.b).observeOn(d.c).concatMap(x.b).observeOn(d.a).map(u.b);
                }
                w[] owArray = new w[]{ot3.concatWith(ot1.map(new y(uoa2))),obj3.map(new z(uoa2)),ot4.map(new a0(uoa2)),t.fromCallable(new l0(uoa2))};
                ot = t.concatArray(owArray);
                goto label_0762 ;
             }
          }else {
             i8 = 0;
             Workspace$Type type = 4;
          }
          long l3 = System.currentTimeMillis();
          if (!obj5.size()) {
             a.D().e(str2, "clipAndExport: ", new RuntimeException("tasks is empty"));
             ot3 = t.just(new e(i8));
             goto label_0492 ;
          }else {
             obj = obj5;
             ot3 = t.fromIterable(obj5).observeOn(d.c).map(new s(l1, p2)).buffer(obj5.size()).doOnNext(l.b).flatMap(new o(p4)).doOnNext(new q0(l3, obj3, obj)).doOnComplete(new v(l3)).doOnDispose(new f0(l3)).doOnError(new p0(l3, obj3));
             goto label_0514 ;
          }
       }
    }
    public boolean Q0(e p0){
       List obj = PatchProxy.applyOneRefs(p0, this, o1.class, "19");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       obj = p0.k();
       boolean b = false;
       e uoe = (!TextUtils.x(p0.r) || p0.o != null)? 1: null;
       Iterator iterator = obj.iterator();
       boolean b1 = iterator.hasNext();
       while (b1) {
          b1 = iterator.next();
          if (TextUtils.x(b1.r)) {
             b1 = b1.o;
             if (b1 == null) {
             }
          }
          uoe = 1;
          break ;
       }
       if (uoe) {
          return b;
       }else if(p0.B != null){
          b = true;
       }
       Iterator iterator1 = obj.iterator();
       while (true) {
          if (iterator1.hasNext()) {
             if (iterator1.next().B != null) {
                b = true;
             }
          }
          if (b) {
             break ;
          }else {
             return 1;
          }
       }
       return (b1.c().matcher(TextUtils.k(p0.g())).matches() ^ 1);
    }
    public boolean S(){
       Object obj = PatchProxy.apply(null, this, o1.class, "44");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       return d.c(this.getTemplateId());
    }
    public List V(c p0,boolean p1){
       List obj;
       o1 oo1 = o1.class;
       if (PatchProxy.isSupport(oo1)) {
          obj = PatchProxy.applyTwoRefs(p0, Boolean.valueOf(p1), this, oo1, "15");
          if (obj != PatchProxyResult.class) {
             return obj;
          }
       }
       obj = this.d.f();
       ArrayList uArrayList = new ArrayList();
       int i = 0;
       while (i < obj.size()) {
          b uob = obj.get(i);
          if (!q.f(uob.c)) {
             e uoe = uob.c.get(0);
             if (uoe != null) {
                e b = uoe.b;
                if (!TextUtils.x(b)) {
                   uArrayList.add(this.u0(b, uoe, p0));
                }
             }
          }
          i = i + 1;
       }
       return uArrayList;
    }
    public String Z(boolean p0){
       Object[] obj;
       int i1;
       int i2;
       String str;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       o1 oo1 = o1.class;
       if (PatchProxy.isSupport(oo1)) {
          obj = PatchProxy.applyOneRefs(Boolean.valueOf(p0), this, oo1, "20");
          if (obj != patchProxyRe) {
             return obj;
          }
       }
       int i = 1;
       if (p0) {
          i1 = 1;
       }else {
          Object[] objArray = null;
          Object obj1 = PatchProxy.apply(objArray, this, oo1, "22");
          if (obj1 != patchProxyRe) {
             i1 = obj1.intValue();
          }else {
             oo1 = this.d;
             Objects.requireNonNull(oo1);
             Object obj2 = PatchProxy.apply(objArray, oo1, d.class, "3");
             i1 = (obj2 != patchProxyRe)? obj2.intValue(): oo1.e.size();
          }
       }
       if (this.K0()) {
          i2 = (this.L0())? 0x7f101b9d: 0x7f101bee;
          obj = new Object[i];
          obj[0] = Integer.valueOf(i1);
          str = String.format(a1.p(i2), obj);
       }else if(this.L0()){
          i2 = 0x7f101b9c;
       }else {
          i2 = 0x7f101ba1;
       }
       obj = new Object[i];
       obj[0] = Integer.valueOf(i1);
       str = String.format(a1.p(i2), obj);
       return str;
    }
    public String a0(String p0){
       Object obj = PatchProxy.applyOneRefs(p0, this, o1.class, "46");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       e uoe = this.A0(p0);
       uoe = (uoe == null)? null: uoe.i();
       return uoe;
    }
    public boolean c0(){
       boolean b;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       o1 oo1 = o1.class;
       Object[] objArray = null;
       e obj = PatchProxy.apply(objArray, this, oo1, "38");
       if (obj != patchProxyRe) {
          return obj.booleanValue();
       }
       if (!this.k0().isServerEffectTemplate()) {
          Object[] objArray1 = PatchProxy.apply(objArray, this, oo1, "40");
          if (objArray1 != patchProxyRe) {
          }else {
             oo1 = this.d;
             Objects.requireNonNull(oo1);
             obj = PatchProxy.apply(objArray, oo1, d.class, "22");
             if (obj != patchProxyRe) {
                objArray = obj;
             }else {
                Iterator iterator = oo1.e.iterator();
                while (iterator.hasNext()) {
                   Iterator iterator1 = iterator.next().c.iterator();
                   while (true) {
                      if (iterator1.hasNext()) {
                         obj = iterator1.next();
                         if (!TextUtils.x(obj.r)) {
                            objArray = obj.r;
                         }else {
                            Iterator iterator2 = obj.k().iterator();
                            while (true) {
                               if (iterator2.hasNext()) {
                                  e uoe = iterator2.next();
                                  if (!TextUtils.x(uoe.r)) {
                                     objArray = uoe.r;
                                     break ;
                                  }
                               }else {
                                  continue ;
                               }
                            }
                         }
                      }else {
                         continue ;
                      }
                   }
                   return b;
                }
             }
             objArray1 = objArray;
          }
          if (TextUtils.x(objArray1)) {
             b = false;
             goto label_0094 ;
          }
       }
       b = true;
       goto label_0094 ;
    }
    public void close(){
       o1 oo1 = o1.class;
       Object[] objArray = null;
       if (PatchProxy.applyVoid(objArray, this, oo1, "24")) {
          return;
       }
       Object[] objArray1 = new Object[0];
       e.D().s("KuaiShanProject", "close\(\) called", objArray1);
       if (this.h != null) {
          this.h = objArray;
       }
       o1 tj = this.j;
       if (tj != null && tj.getTemplateType() == EditorSdk2MvCreationResult$TemplateType.TEMPLATE_TYPE_NEW_SPARK) {
          NewSparkTemplateManager.nativeClearCutOutCache();
       }
       if (!PatchProxy.applyVoidOneRefs(objArray, this, oo1, "1")) {
          objArray1 = new Object[0];
          e.D().s("KuaiShanProject", "setPreviewPlayer: player=null", objArray1);
          tj = this.k;
          if (tj != null) {
             tj.setPreviewEventListener("KuaiShanProject", objArray);
          }
          this.k = objArray;
          if (!PatchProxy.applyVoid(objArray, this, oo1, "4")) {
             oo1 = this.k;
             if (oo1 != null) {
                oo1.setVideoProject(this.h);
                oo1 = this.j;
                if (oo1 != null && oo1.getTemplateType() == EditorSdk2MvCreationResult$TemplateType.TEMPLATE_TYPE_NEW_SPARK) {
                   NewSparkTemplateManager.nativeSetCutOutCache(e.h()+"/cut_out_cache", 1024.00f);
                }
             }
          }
       }
    label_0085 :
       oo1 = this.l;
       if (oo1 != null && !oo1.isDisposed()) {
          this.l.dispose();
          this.l = objArray;
       }
       oo1 = this.m;
       if (oo1 != null) {
          oo1.dispose();
          this.m = objArray;
       }
       oo1 = this.d;
       Objects.requireNonNull(oo1);
       if (!PatchProxy.applyVoid(objArray, oo1, d.class, "8")) {
          oo1.e.clear();
          oo1.f.clear();
          oo1.b = 0;
          oo1.c = 0;
       }
       this.b();
       this.n.clear();
       return;
    }
    public EditorSdk2V2$VideoEditorProject e(){
       o1 obj = PatchProxy.apply(null, this, o1.class, "7");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       obj = this.h;
       Objects.requireNonNull(obj);
       return obj;
    }
    public EditorSdk2MvAsset e0(String p0){
       Object obj = PatchProxy.applyOneRefs(p0, this, o1.class, "32");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       e uoe = this.d.g(p0);
       if (uoe == null) {
          return null;
       }
       return uoe.t;
    }
    public boolean g(){
       Iterator obj = PatchProxy.apply(null, this, o1.class, "3");
       if (obj != PatchProxyResult.class) {
          return obj.booleanValue();
       }
       if (this.e.isServerEffectTemplate()) {
          return true;
       }
       obj = this.d.c().iterator();
       while (true) {
          if (!obj.hasNext()) {
             return false;
          }
          if (!TextUtils.x(obj.next().r)) {
             break ;
          }
       }
       return true;
    }
    public int getErrorCode(){
       return c.b(this);
    }
    public String getGroupId(){
       return this.e.mGroupId;
    }
    public String getTemplateId(){
       return this.e.mTemplateId;
    }
    public ArrayList h(String p0){
       Object[] objArray;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       o1 obj = PatchProxy.applyOneRefs(p0, this, o1.class, "31");
       if (obj != patchProxyRe) {
          return obj;
       }
       obj = this.d;
       o1 tn = this.n;
       ArrayList uArrayList = PatchProxy.applyThreeRefs(p0, obj, tn, null, e.class, "60");
       if (uArrayList != patchProxyRe) {
       }else {
          uArrayList = new ArrayList();
          if (p0 != null) {
             e uoe = obj.g(p0);
             if (uoe != null && uoe.g() != null) {
                QMedia qMedia = e.e(uoe.g(), uoe.h(), tn);
                if (qMedia != null) {
                   uArrayList.add(qMedia);
                }
             }
          }else {
             Objects.requireNonNull(obj);
             ArrayList uArrayList1 = PatchProxy.apply(null, obj, d.class, "10");
             if (uArrayList1 != patchProxyRe) {
             }else {
                uArrayList1 = new ArrayList();
                Iterator iterator1 = obj.e.iterator();
                while (iterator1.hasNext()) {
                   Iterator iterator2 = iterator1.next().c.iterator();
                   while (iterator2.hasNext()) {
                      e uoe2 = iterator2.next();
                      if (uoe2.a()) {
                         Object[] objArray1 = new Object[0];
                         e.D().s("KuaiShanTemplate", "getReadyAreasOrderByFrameIndex: area ="+uoe2, objArray1);
                         uArrayList1.add(uoe2);
                      }
                   }
                }
             }
             Iterator iterator = uArrayList1.iterator();
             while (iterator.hasNext()) {
                e uoe1 = iterator.next();
                if (TextUtils.x(uoe1.g())) {
                   objArray = new Object[0];
                   e.D().t("KSUtil", "getMediaListFromTemplate area.getMediaPath\(\) is null, area = "+uoe1, objArray);
                }else {
                   QMedia qMedia1 = e.e(uoe1.g(), uoe1.h(), tn);
                   if (qMedia1 == null) {
                      objArray = new Object[0];
                      e.D().t("KSUtil", "getMediaList: cant find qmedia for "+uoe1, objArray);
                   }else {
                      uArrayList.add(qMedia1);
                   }
                }
             }
          }
       }
       return uArrayList;
    }
    public KSTemplateDetailInfo k0(){
       return this.e;
    }
    public int q(){
       return this.d.c;
    }
    public AE2Project s(){
       Object[] objArray = null;
       o1 obj = PatchProxy.apply(objArray, this, o1.class, "8");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       obj = this.j;
       if (obj != null) {
          objArray = obj.getAE2Project();
       }
       return objArray;
    }
    public final f u0(String p0,e p1,c p2){
       QMedia qMedia1;
       QMedia qMedia2;
       Pair first;
       o1 oo1 = this;
       String str = p0;
       e uoe = p1;
       c uoc = p2;
       String obj = PatchProxy.applyThreeRefs(p0, p1, p2, this, o1.class, "18");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       obj = (p1.e().first == null)? "": p1.e().first;
       String str1 = p1.g();
       if (uoc && (p2.F0() != null && p2.F0().D())) {
          String str2 = e.k(uoc, str);
          if (!TextUtils.x(str2)) {
             obj = str2;
          }
          KuaishanAsset kuaishanAsse = e.g(uoc, str);
          if (kuaishanAsse != null) {
             str1 = kuaishanAsse.getAssetId();
          }
       }
    label_005d :
       boolean b = DraftUtils.R(p2);
       boolean b1 = DraftUtils.P(p2);
       boolean b2 = (uoc != null && DraftUtils.f0(p2))? true: false;
       double d = (double)p1.h() / 0x408f400000000000;
       double d1 = p1.f();
       QMedia qMedia = this.y0(p0);
       if (qMedia != null) {
          QMedia mExportWidth = qMedia.mExportWidth;
          if (mExportWidth <= null) {
             mExportWidth = qMedia.getWidth();
          }
          QMedia mExportHeigh = qMedia.mExportHeight;
          if (mExportHeigh <= null) {
             mExportHeigh = qMedia.getHeight();
          }
          qMedia1 = mExportWidth;
          qMedia2 = mExportHeigh;
       }else {
          qMedia1 = 0;
          qMedia2 = 0;
       }
       boolean b3 = (!p1.k().isEmpty() && (!TextUtils.n(p1.b(), KuaiShanAssetTag.OPENING.getAssetTag()) && !TextUtils.n(p1.b(), KuaiShanAssetTag.ENDING.getAssetTag())))? true: false;
       ArrayList uArrayList = new ArrayList();
       Iterator iterator = p1.k().iterator();
       while (iterator.hasNext()) {
          e uoe1 = iterator.next();
          if (!TextUtils.x(uoe1.b)) {
             uArrayList.add(oo1.u0(uoe1.b, uoe1, uoc));
          }
       }
       String iterator1 = (uoe.p != null)? p1.c(): null;
       f uof = new f(TextUtils.k(str1), uoe.d, p1.b(), p1.j(), obj, d, d1, uoe.u, uoe.v, qMedia1, qMedia2, p0, false, b3, oo1.Q0(uoe), uArrayList, p1.d(), iterator1, b, b1, b2);
       return iterator1;
    }
    public List v0(){
       Object obj = PatchProxy.apply(null, this, o1.class, "10");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       return this.d.c();
    }
    public String w0(){
       return this.e.mTemplateId;
    }
    public long[] x0(boolean p0){
       Iterator obj;
       long[] olongArray;
       List obj1;
       double d;
       PatchProxyResult patchProxyRe = PatchProxyResult.class;
       o1 oo1 = o1.class;
       if (PatchProxy.isSupport(oo1)) {
          obj = PatchProxy.applyOneRefs(Boolean.valueOf(p0), this, oo1, "43");
          if (obj != patchProxyRe) {
             return obj;
          }
       }
       oo1 = this.d;
       Objects.requireNonNull(oo1);
       b uob = b.class;
       d uod = d.class;
       if (PatchProxy.isSupport(uod)) {
          olongArray = PatchProxy.applyOneRefs(Boolean.valueOf(p0), oo1, uod, "28");
          if (olongArray != patchProxyRe) {
          }else {
          label_0038 :
             ArrayList uArrayList = new ArrayList();
             obj = oo1.e.iterator();
             int i = 0;
             while (obj.hasNext()) {
                b uob1 = obj.next();
                if (uob1.a() != null && (!(uob1.a()).isEmpty() && !(uob1.a()).contains("ms_album"))) {
                   continue ;
                }else {
                   long l = 0;
                   Object[] objArray = null;
                   if (p0) {
                      obj1 = PatchProxy.apply(objArray, uob1, uob, "10");
                      if (obj1 != patchProxyRe) {
                         l = obj1.longValue();
                      }else if(uob1.c.isEmpty()){
                         l = uob1.c.get(i).h();
                      }
                      uArrayList.add(Long.valueOf(l));
                   }else {
                      obj1 = PatchProxy.apply(objArray, uob1, uob, "11");
                      if (obj1 != patchProxyRe) {
                      }else if(uob1.c.isEmpty()){
                         obj1 = Collections.emptyList();
                      }else {
                         e y = uob1.c.get(i).y;
                      }
                      EditorSdk2$TimeRange timeRange = d.b(obj1);
                      if (timeRange == null) {
                         uArrayList.add(Long.valueOf(l));
                      }else {
                         d = timeRange.duration() * 0x408f400000000000;
                         uArrayList.add(Long.valueOf((long)d));
                      }
                   }
                }
             }
             if (uArrayList instanceof Longs$LongArrayAsList) {
                olongArray = uArrayList.toLongArray();
             }else {
                Object[] objArray1 = uArrayList.toArray();
                int len = objArray1.length;
                long[] olongArray1 = new long[len];
                for (; i < len; i = i + 1) {
                   object oobject = objArray1[i];
                   n.j(oobject);
                   olongArray1[i] = oobject.longValue();
                }
                olongArray = olongArray1;
             }
          }
       }else {
          goto label_0038 ;
       }
       return olongArray;
    }
    public QMedia y0(String p0){
       Object obj = PatchProxy.applyOneRefs(p0, this, o1.class, "21");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       ArrayList uArrayList = this.h(p0);
       if (q.f(uArrayList)) {
          return null;
       }
       return uArrayList.get(0);
    }
    public Pair z(String p0){
       Pair pair;
       e uoe;
       Iterator obj = PatchProxy.applyOneRefs(p0, this, o1.class, "16");
       if (obj != PatchProxyResult.class) {
          return obj;
       }
       obj = this.d.f().iterator();
       while (true) {
          pair = null;
          if (obj.hasNext()) {
             b uob = obj.next();
             if (uob.c.isEmpty()) {
                continue ;
             }else {
                uoe = uob.c.get(0);
                if (uoe.m() || (!TextUtils.x(p0) && (TextUtils.x(uoe.b()) || !(uoe.b()).contains(p0)))) {
                   continue ;
                }
             }
          }else {
             uoe = pair;
          }
          if (uoe != null) {
             pair = new Pair(uoe.b, uoe.a);
             break ;
          }
          break ;
       }
       return pair;
    }
    public EditorSdk2MvCreationResult z0(){
       return this.j;
    }
}
